{"title":"An√°lisis estatuto de Urrao","markdown":{"yaml":{"title":"An√°lisis estatuto de Urrao","format":{"html":{"toc":true,"toc-depth":3,"number-sections":true,"theme":"cosmo","smooth-scroll":true}},"execute":{"echo":false,"warning":false,"message":false},"params":{"cod_dane":"05847","nombre":"Urrao"},"lang":"es"},"headingText":"Funci√≥n para leer archivos RDS con rutas relativas","containsRefs":false,"markdown":"\n\n\nEste proyecto presenta un an√°lisis exhaustivo de los estatutos tributarios del municipio de \nPara el an√°lisis del municipio de , enfoc√°ndose espec√≠ficamente en la estructura del impuesto predial. El estatuto fue acompa√±ado de un an√°lisis jur√≠dico y de contenido detallado del cap√≠tulo de impuestos prediales contenido en sus estatutos de rentas.\n\nPara el an√°lisis del municipio se tuvieron  en cuenta los siguientes estatutos y modificaciones:\n\n```{r}\n#| echo: false\n#| message: false\n#| warning: false\n\nlee_rds <- function(rel){\n  candidatos <- c(rel, file.path('..', rel), file.path('..','..', rel))\n  existente <- candidatos[file.exists(candidatos)][1]\n  if(is.na(existente)) stop('No se encontr√≥ ', rel, ' en rutas: ', paste(candidatos, collapse=', '))\n  readRDS(existente)\n}\n\n# Cargar librer√≠as necesarias\nlibrary(dplyr)\nlibrary(knitr)\nlibrary(ggplot2)\nlibrary(scales)\nsuppressPackageStartupMessages({\n  library(gridExtra, quietly = TRUE)\n  library(grid, quietly = TRUE)\n  library(tidyr, quietly = TRUE)\n})\n\n# Configurar opciones de gr√°ficos\noptions(scipen = 999)  # Evitar notaci√≥n cient√≠fica\n\n# Cargar datos completos con manejo de ausencia del archivo\ndatos_disponibles <- TRUE\nbd_estatutos <- NULL\ntryCatch({\n  bd_estatutos <- lee_rds(\"ds_estatutos/BD_Estatutos.rds\")\n}, error = function(e){\n  datos_disponibles <<- FALSE\n  mensaje <- paste0(\"‚ö†Ô∏è No se encontr√≥ el dataset 'BD_Estatutos.rds'. Se mostrar√° una versi√≥n reducida del informe. Detalle: \", e$message)\n  message(mensaje)\n  cat(mensaje, \"\\n\\n\")\n})\n\n# Filtrar para el municipio espec√≠fico (si hay datos)\nif (datos_disponibles) {\n  datos_municipio <- bd_estatutos %>% filter(codigo_dane == params$cod_dane)\n} else {\n  datos_municipio <- data.frame()\n}\n\n# Tabla de estatutos\nfreq_cat <- datos_municipio %>%\n  mutate(\n    filename = if ('filename' %in% names(cur_data_all())) filename else NA_character_,\n    enlace_pdf = if_else(!is.na(filename) & filename != \"\", \n                         paste0(\"[Descargar PDF](pdfs/\", filename, \")\"), \n                         \"No disponible\")\n  ) %>%\n  select(any_of(c(\"mpio\",\"anio\",\"tipo\",\"numero\",\"observaciones\",\"enlace_pdf\")))\n\nif (nrow(freq_cat) == 0) {\n  cat(\"No hay estatutos registrados para este municipio.\\n\")\n} else {\n  knitr::kable(head(freq_cat, 200), caption = \"Estatutos Usados para el Estudio\", escape = FALSE)\n}\n```\n\n\nPara ver m√°s an√°lisis agregados y los detalles metodol√≥gicos puede visitar este enlace [(ir)](https://jcmunozmora.github.io/estatutos_analisis/).\n\n# Estad√≠sticas del municipio\n\n```{r}\n#| echo: false\n#| message: false\n#| warning: false\n\nif (nrow(datos_municipio) > 0) {\n  # Estad√≠sticas b√°sicas\n  cat(\"## Resumen estad√≠stico\\n\\n\")\n  cat(\"- **Total de registros analizados:** \", nrow(datos_municipio), \"\\n\")\n  \n  if (\"anio\" %in% names(datos_municipio)) {\n    anos_unicos <- sort(unique(datos_municipio$anio[!is.na(datos_municipio$anio)]))\n    if (length(anos_unicos) > 0) {\n      cat(\"- **Per√≠odo analizado:** \", min(anos_unicos), \" - \", max(anos_unicos), \"\\n\")\n      cat(\"- **A√±os con estatutos:** \", paste(anos_unicos, collapse = \", \"), \"\\n\")\n    }\n  }\n  \n  if (\"tipo\" %in% names(datos_municipio)) {\n    tipos_unicos <- unique(datos_municipio$tipo[!is.na(datos_municipio$tipo)])\n    if (length(tipos_unicos) > 0) {\n      cat(\"- **Tipos de normativa:** \", paste(tipos_unicos, collapse = \", \"), \"\\n\")\n    }\n  }\n  \n  # Comparaci√≥n con el departamento\n  total_departamento <- nrow(bd_estatutos)\n  porcentaje <- round((nrow(datos_municipio) / total_departamento) * 100, 2)\n  cat(\"- **Representaci√≥n en el estudio:** \", porcentaje, \"% del total departamental\\n\")\n  \n} else {\n  cat(\"No hay datos disponibles para generar estad√≠sticas.\\n\")\n}\n```\n\n# An√°lisis de estructura tarifaria\n\n## Combinaciones de criterios tarifarios\n\n```{r}\n#| echo: false\n#| results: asis\n#| fig-width: 10\n#| fig-height: 6\n\n# Verificar si existe la imagen de combinaciones para este municipio\nimg_combos <- paste0(\"img_estatutos/\", params$cod_dane, \"_combos.png\")\n\nif (file.exists(img_combos)) {\n  cat(\"Este gr√°fico muestra las diferentes combinaciones de criterios utilizados en la estructura tarifaria del municipio:\\n\\n\")\n  cat(\"![Combinaciones de criterios tarifarios](\", img_combos, \"){width=90%}\\n\\n\")\n  cat(\"**Descripci√≥n:** Visualizaci√≥n de las combinaciones de criterios (aval√∫o, √°rea, destino, estrato, etc.) utilizadas para determinar las tarifas prediales en \", params$nombre, \".\\n\\n\")\n  cat(\"**Interpretaci√≥n:** Cada combinaci√≥n representa una regla espec√≠fica del estatuto tributario. Mayor n√∫mero de combinaciones indica mayor complejidad normativa.\\n\\n\")\n} else {\n  # Generar an√°lisis din√°mico desde los datos\n  cat(\"### An√°lisis de criterios tarifarios (generado din√°micamente)\\n\\n\")\n  \n  tryCatch({\n    bd_transcripciones <- lee_rds(\"ds_estatutos/BD_Transcripciones.rds\")\n    \n    # Filtrar datos del municipio\n    datos_criterios <- bd_transcripciones %>%\n      filter(codigo_dane == params$cod_dane)\n    \n    if (nrow(datos_criterios) > 0) {\n      library(ggplot2)\n      library(dplyr)\n      \n      # Analizar qu√© criterios se utilizan\n      criterios_utilizados <- datos_criterios %>%\n        summarise(\n          usa_avaluo = any(!is.na(avaluo_desde) | !is.na(avaluo_hasta)),\n          usa_area = any(!is.na(area_desde) | !is.na(area_hasta)),\n          usa_destino = any(!is.na(destino) & destino != \"\"),\n          usa_estrato = any(!is.na(estrato) & estrato != \"\"),\n          usa_zona = any(!is.na(zona) & zona != \"\")\n        )\n      \n      # Crear resumen de criterios\n      criterios_activos <- c()\n      if (criterios_utilizados$usa_avaluo) criterios_activos <- c(criterios_activos, \"Aval√∫o\")\n      if (criterios_utilizados$usa_area) criterios_activos <- c(criterios_activos, \"√Årea\")\n      if (criterios_utilizados$usa_destino) criterios_activos <- c(criterios_activos, \"Destino\")\n      if (criterios_utilizados$usa_estrato) criterios_activos <- c(criterios_activos, \"Estrato\")\n      if (criterios_utilizados$usa_zona) criterios_activos <- c(criterios_activos, \"Zona\")\n      \n      cat(\"**Criterios tarifarios identificados:**\\n\")\n      if (length(criterios_activos) > 0) {\n        for (criterio in criterios_activos) {\n          cat(\"- ‚úì \", criterio, \"\\n\")\n        }\n      } else {\n        cat(\"- No se identificaron criterios espec√≠ficos en los datos disponibles\\n\")\n      }\n      cat(\"\\n\")\n      \n      # An√°lisis de combinaciones m√°s frecuentes\n      if (length(criterios_activos) > 1) {\n        # Crear combinaciones de criterios\n        combinaciones <- datos_criterios %>%\n          mutate(\n            combinacion = paste(\n              ifelse(!is.na(avaluo_desde) | !is.na(avaluo_hasta), \"Aval√∫o\", \"\"),\n              ifelse(!is.na(area_desde) | !is.na(area_hasta), \"√Årea\", \"\"),\n              ifelse(!is.na(destino) & destino != \"\", \"Destino\", \"\"),\n              ifelse(!is.na(estrato) & estrato != \"\", \"Estrato\", \"\"),\n              ifelse(!is.na(zona) & zona != \"\", \"Zona\", \"\"),\n              sep = \"+\"\n            )\n          ) %>%\n          mutate(combinacion = gsub(\"\\\\+{2,}\", \"+\", combinacion)) %>%\n          mutate(combinacion = gsub(\"^\\\\+|\\\\+$\", \"\", combinacion)) %>%\n          filter(combinacion != \"\") %>%\n          count(combinacion, sort = TRUE)\n        \n        if (nrow(combinaciones) > 0) {\n          cat(\"**Combinaciones de criterios m√°s frecuentes:**\\n\")\n          for (i in 1:min(5, nrow(combinaciones))) {\n            cat(\"- \", combinaciones$combinacion[i], \": \", combinaciones$n[i], \" reglas\\n\")\n          }\n          cat(\"\\n\")\n          \n          # Gr√°fico de barras de combinaciones\n          if (nrow(combinaciones) > 1) {\n            p_combos <- ggplot(head(combinaciones, 10), aes(x = reorder(combinacion, n), y = n)) +\n              geom_col(fill = \"steelblue\", alpha = 0.8) +\n              coord_flip() +\n              labs(\n                title = paste(\"Combinaciones de criterios tarifarios -\", params$nombre),\n                subtitle = \"Top 10 combinaciones m√°s utilizadas\",\n                x = \"Combinaci√≥n de criterios\",\n                y = \"N√∫mero de reglas\",\n                caption = \"Fuente: An√°lisis de estatutos tributarios\"\n              ) +\n              theme_minimal() +\n              theme(\n                plot.title = element_text(size = 14, face = \"bold\"),\n                plot.subtitle = element_text(size = 12),\n                axis.title = element_text(size = 11)\n              )\n            \n            print(p_combos)\n          }\n        }\n      }\n      \n      # Estad√≠sticas de complejidad\n      cat(\"\\n**An√°lisis de complejidad normativa:**\\n\")\n      cat(\"- **Total de reglas analizadas:** \", nrow(datos_criterios), \"\\n\")\n      cat(\"- **N√∫mero de criterios utilizados:** \", length(criterios_activos), \"\\n\")\n      \n      if (length(criterios_activos) >= 3) {\n        cat(\"- **Clasificaci√≥n:** Sistema de alta complejidad (m√∫ltiples criterios)\\n\")\n      } else if (length(criterios_activos) == 2) {\n        cat(\"- **Clasificaci√≥n:** Sistema de complejidad moderada\\n\")\n      } else {\n        cat(\"- **Clasificaci√≥n:** Sistema de baja complejidad (criterio √∫nico o simple)\\n\")\n      }\n      \n    } else {\n      cat(\"No se encontraron datos de criterios tarifarios para este municipio.\\n\")\n    }\n    \n  }, error = function(e) {\n    cat(\"*No fue posible generar el an√°lisis de criterios tarifarios para este municipio.*\\n\")\n    cat(\"*Motivo: Datos de transcripci√≥n no disponibles o incompletos.*\\n\")\n  })\n}\n```\n\n## Distribuci√≥n de tarifas\n\n```{r}\n#| echo: false\n#| results: asis\n#| fig-width: 10\n#| fig-height: 6\n\n# Verificar si existe la imagen de distribuci√≥n de tarifas\nimg_tarifas <- paste0(\"img_estatutos/\", params$cod_dane, \"_dist_tarifas.png\")\n\nif (file.exists(img_tarifas)) {\n  cat(\"La distribuci√≥n de tarifas muestra el rango y frecuencia de las diferentes tarifas prediales establecidas:\\n\\n\")\n  cat(\"![Distribuci√≥n de tarifas prediales](\", img_tarifas, \"){width=90%}\\n\\n\")\n  cat(\"**Descripci√≥n:** Histograma que muestra la distribuci√≥n de las tarifas prediales por mil (‚Ä∞) establecidas en el estatuto de \", params$nombre, \".\\n\\n\")\n  cat(\"**Interpretaci√≥n:** La forma de la distribuci√≥n indica si el municipio tiende hacia tarifas uniformes (distribuci√≥n concentrada) o hacia un esquema m√°s diversificado (distribuci√≥n dispersa).\\n\\n\")\n} else {\n  # Generar gr√°fico din√°mico desde los datos\n  cat(\"### Distribuci√≥n de tarifas prediales (generado din√°micamente)\\n\\n\")\n  \n  tryCatch({\n    bd_transcripciones <- lee_rds(\"ds_estatutos/BD_Transcripciones.rds\")\n    \n    # Filtrar datos del municipio\n    datos_tarifas <- bd_transcripciones %>%\n      filter(codigo_dane == params$cod_dane) %>%\n      filter(!is.na(tarifa), tarifa > 0)\n    \n    if (nrow(datos_tarifas) > 0) {\n      library(ggplot2)\n      \n      # Crear histograma de distribuci√≥n de tarifas mejorado\n      p_dist <- ggplot(datos_tarifas, aes(x = tarifa)) +\n        geom_histogram(aes(y = after_stat(density)), \n                       bins = min(30, max(5, nrow(datos_tarifas)/3)), \n                       fill = \"lightblue\", color = \"darkblue\", alpha = 0.7, size = 0.3) +\n        geom_density(alpha = 0.3, fill = \"blue\", color = \"blue\", size = 1) +\n        geom_vline(aes(xintercept = median(tarifa)), \n                   color = \"red\", linetype = \"dashed\", size = 1.2) +\n        geom_vline(aes(xintercept = mean(tarifa)), \n                   color = \"orange\", linetype = \"dashed\", size = 1.2) +\n        geom_vline(aes(xintercept = quantile(tarifa, 0.25)), \n                   color = \"purple\", linetype = \"dotted\", size = 0.8, alpha = 0.7) +\n        geom_vline(aes(xintercept = quantile(tarifa, 0.75)), \n                   color = \"purple\", linetype = \"dotted\", size = 0.8, alpha = 0.7) +\n        scale_x_continuous(\n          labels = scales::number_format(suffix = \"‚Ä∞\"),\n          name = \"Tarifa predial (por mil)\"\n        ) +\n        scale_y_continuous(\n          name = \"Densidad de probabilidad\",\n          labels = scales::number_format(accuracy = 0.01)\n        ) +\n        labs(\n          title = paste(\"Distribuci√≥n de tarifas prediales -\", params$nombre),\n          subtitle = \"üî¥ Mediana | üü† Promedio | üü£ Cuartiles (P25, P75) | üîµ Curva de densidad\",\n          caption = \"An√°lisis de concentraci√≥n y dispersi√≥n tarifaria\"\n        ) +\n        theme_minimal() +\n        theme(\n          plot.title = element_text(size = 14, face = \"bold\", color = \"darkblue\"),\n          plot.subtitle = element_text(size = 10, color = \"gray40\"),\n          plot.caption = element_text(size = 9, color = \"gray50\"),\n          axis.title = element_text(size = 11),\n          panel.grid.minor = element_blank(),\n          panel.grid.major = element_line(color = \"gray90\", size = 0.5)\n        )\n      \n      print(p_dist)\n      \n      # Estad√≠sticas descriptivas mejoradas\n      tarifas_unicas <- unique(datos_tarifas$tarifa)\n      rango_tarifas <- max(datos_tarifas$tarifa) - min(datos_tarifas$tarifa)\n      q10 <- quantile(datos_tarifas$tarifa, 0.1)\n      q90 <- quantile(datos_tarifas$tarifa, 0.9)\n      asimetria <- round((mean(datos_tarifas$tarifa) - median(datos_tarifas$tarifa)) / sd(datos_tarifas$tarifa), 3)\n      \n      cat(\"\\n**Estad√≠sticas descriptivas detalladas:**\\n\")\n      cat(\"- **N√∫mero total de tarifas diferentes:** \", length(tarifas_unicas), \"\\n\")\n      cat(\"- **Rango de tarifas:** \", min(datos_tarifas$tarifa), \"‚Ä∞ - \", max(datos_tarifas$tarifa), \"‚Ä∞ (amplitud: \", round(rango_tarifas, 2), \"‚Ä∞)\\n\")\n      cat(\"- **Medidas de tendencia central:**\\n\")\n      cat(\"  - Promedio: \", round(mean(datos_tarifas$tarifa), 2), \"‚Ä∞\\n\")\n      cat(\"  - Mediana: \", round(median(datos_tarifas$tarifa), 2), \"‚Ä∞\\n\")\n      cat(\"  - Moda: \", round(as.numeric(names(sort(table(datos_tarifas$tarifa), decreasing = TRUE))[1]), 2), \"‚Ä∞\\n\")\n      cat(\"- **Medidas de dispersi√≥n:**\\n\")\n      cat(\"  - Desviaci√≥n est√°ndar: \", round(sd(datos_tarifas$tarifa), 2), \"‚Ä∞\\n\")\n      cat(\"  - Coeficiente de variaci√≥n: \", round(sd(datos_tarifas$tarifa)/mean(datos_tarifas$tarifa), 3), \"\\n\")\n      cat(\"  - Rango intercuart√≠lico (P25-P75): \", round(quantile(datos_tarifas$tarifa, 0.75) - quantile(datos_tarifas$tarifa, 0.25), 2), \"‚Ä∞\\n\")\n      cat(\"- **Percentiles clave:**\\n\")\n      cat(\"  - P10: \", round(q10, 2), \"‚Ä∞ | P90: \", round(q90, 2), \"‚Ä∞\\n\")\n      cat(\"- **Forma de la distribuci√≥n:**\\n\")\n      cat(\"  - Asimetr√≠a: \", asimetria, if(asimetria > 0.5) \" (sesgada hacia la derecha)\" else if(asimetria < -0.5) \" (sesgada hacia la izquierda)\" else \" (aproximadamente sim√©trica)\", \"\\n\")\n      \n      # An√°lisis de dispersi√≥n con interpretaci√≥n contextual\n      cv <- sd(datos_tarifas$tarifa)/mean(datos_tarifas$tarifa)\n      \n      cat(\"\\n**üìä An√°lisis de concentraci√≥n tarifaria:**\\n\")\n      if (cv < 0.15) {\n        cat(\"- **Tipo de sistema:** UNIFORME - Las tarifas est√°n muy concentradas\\n\")\n        cat(\"- **Ventajas:** Simplicidad administrativa, f√°cil comprensi√≥n ciudadana\\n\")\n        cat(\"- **Consideraciones:** Evaluar si captura diferencias en capacidad contributiva\\n\")\n      } else if (cv < 0.30) {\n        cat(\"- **Tipo de sistema:** MODERADAMENTE UNIFORME - Concentraci√≥n con cierta variabilidad\\n\")\n        cat(\"- **Ventajas:** Balance entre simplicidad y diferenciaci√≥n\\n\")\n        cat(\"- **Consideraciones:** Sistema equilibrado para contextos urbanos/rurales mixtos\\n\")\n      } else if (cv < 0.70) {\n        cat(\"- **Tipo de sistema:** DIVERSIFICADO - Amplio rango de tarifas\\n\")\n        cat(\"- **Ventajas:** Mayor precisi√≥n en la diferenciaci√≥n contributiva\\n\")\n        cat(\"- **Consideraciones:** Requiere mayor capacidad t√©cnica para aplicaci√≥n\\n\")\n      } else {\n        cat(\"- **Tipo de sistema:** ALTAMENTE DIVERSIFICADO - Muy amplio espectro tarifario\\n\")\n        cat(\"- **Ventajas:** M√°xima precisi√≥n en diferenciaci√≥n\\n\")\n        cat(\"- **Consideraciones:** Alta complejidad administrativa, revisar coherencia\\n\")\n      }\n      \n      # An√°lisis de percentiles con interpretaci√≥n\n      q25 <- quantile(datos_tarifas$tarifa, 0.25)\n      q75 <- quantile(datos_tarifas$tarifa, 0.75)\n      riq <- q75 - q25\n      cat(\"- **Rango central (P25-P75):** \", round(q25, 2), \"‚Ä∞ - \", round(q75, 2), \"‚Ä∞ (RIQ: \", round(riq, 2), \"‚Ä∞)\\n\")\n      cat(\"- **Concentraci√≥n central:** \", round((riq / median(datos_tarifas$tarifa)) * 100, 1), \"% de la mediana\\n\")\n      \n      # Detecci√≥n de outliers\n      limite_inferior <- q25 - 1.5 * riq\n      limite_superior <- q75 + 1.5 * riq\n      outliers <- datos_tarifas$tarifa[datos_tarifas$tarifa < limite_inferior | datos_tarifas$tarifa > limite_superior]\n      \n      if (length(outliers) > 0) {\n        cat(\"- **‚ö†Ô∏è Valores at√≠picos detectados:** \", length(outliers), \" tarifas fuera del rango normal\\n\")\n        cat(\"  - Tarifas extremas: \", paste(round(sort(outliers), 2), collapse = \"‚Ä∞, \"), \"‚Ä∞\\n\")\n        cat(\"  - **Recomendaci√≥n:** Revisar coherencia de estas tarifas excepcionales\\n\")\n      } else {\n        cat(\"- **‚úÖ Sin valores at√≠picos:** Todas las tarifas est√°n dentro del rango esperado\\n\")\n      }\n      \n    } else {\n      cat(\"No se encontraron datos de tarifas para este municipio.\\n\")\n    }\n    \n  }, error = function(e) {\n    cat(\"*No fue posible generar la distribuci√≥n de tarifas para este municipio.*\\n\")\n    cat(\"*Motivo: Datos de transcripci√≥n no disponibles o incompletos.*\\n\")\n  })\n}\n```\n\n# An√°lisis de progresividad\n\n## Progresividad por aval√∫o\n\n```{r}\n#| echo: false\n#| results: asis\n#| fig-width: 10\n#| fig-height: 6\n\n# Verificar si existe la imagen ladder de aval√∫o\nimg_avaluo <- paste0(\"img_estatutos/\", params$cod_dane, \"_ladder_avaluo.png\")\n\nif (file.exists(img_avaluo)) {\n  cat(\"El an√°lisis de progresividad por aval√∫o eval√∫a si las tarifas aumentan proporcionalmente con el valor del predio:\\n\\n\")\n  cat(\"![Progresividad por aval√∫o](\", img_avaluo, \"){width=90%}\\n\\n\")\n  cat(\"**Descripci√≥n:** Gr√°fico ladder que muestra la relaci√≥n entre rangos de aval√∫o (en UVT) y las tarifas correspondientes en \", params$nombre, \".\\n\\n\")\n  cat(\"**Interpretaci√≥n:** Una tendencia ascendente consistente indica progresividad, donde predios de mayor valor pagan tarifas proporcionalmente m√°s altas. Escalones horizontales indican tramos con tarifa fija.\\n\\n\")\n} else {\n  # Generar gr√°fico din√°mico desde los datos\n  cat(\"### An√°lisis de progresividad por aval√∫o (generado din√°micamente)\\n\\n\")\n  \n  # Intentar cargar datos de transcripciones para an√°lisis detallado\n  tryCatch({\n    bd_transcripciones <- lee_rds(\"ds_estatutos/BD_Transcripciones.rds\")\n    \n    # Filtrar datos del municipio\n    datos_avaluo <- bd_transcripciones %>%\n      filter(codigo_dane == params$cod_dane) %>%\n      filter(!is.na(avaluo_desde) | !is.na(avaluo_hasta)) %>%\n      filter(!is.na(tarifa))\n    \n    if (nrow(datos_avaluo) > 0) {\n      library(ggplot2)\n      \n      # Preparar datos para gr√°fico\n      datos_plot <- datos_avaluo %>%\n        mutate(\n          avaluo_medio = case_when(\n            !is.na(avaluo_desde) & !is.na(avaluo_hasta) ~ (avaluo_desde + avaluo_hasta) / 2,\n            !is.na(avaluo_desde) ~ avaluo_desde,\n            !is.na(avaluo_hasta) ~ avaluo_hasta,\n            TRUE ~ NA_real_\n          ),\n          avaluo_desde = ifelse(is.na(avaluo_desde), 0, avaluo_desde),\n          avaluo_hasta = ifelse(is.na(avaluo_hasta), avaluo_medio * 2, avaluo_hasta)\n        ) %>%\n        filter(!is.na(avaluo_medio), !is.na(tarifa)) %>%\n        arrange(avaluo_medio)\n      \n      if (nrow(datos_plot) >= 2) {\n        # Crear gr√°fico ladder\n        p_avaluo <- ggplot(datos_plot, aes(x = avaluo_medio, y = tarifa)) +\n          geom_step(direction = \"hv\", color = \"steelblue\", size = 1.2) +\n          geom_point(color = \"darkblue\", size = 2) +\n          scale_x_continuous(\n            trans = \"log10\",\n            labels = scales::comma_format(scale = 1e-6, suffix = \"M\"),\n            name = \"Aval√∫o (UVT, escala logar√≠tmica)\"\n          ) +\n          scale_y_continuous(\n            labels = scales::number_format(suffix = \"‚Ä∞\"),\n            name = \"Tarifa predial (por mil)\"\n          ) +\n          labs(\n            title = paste(\"Progresividad por aval√∫o -\", params$nombre),\n            subtitle = \"Relaci√≥n entre rangos de aval√∫o y tarifas prediales\",\n            caption = \"Fuente: An√°lisis de estatutos tributarios\"\n          ) +\n          theme_minimal() +\n          theme(\n            plot.title = element_text(size = 14, face = \"bold\"),\n            plot.subtitle = element_text(size = 12),\n            axis.title = element_text(size = 11),\n            panel.grid.minor = element_blank()\n          )\n        \n        print(p_avaluo)\n        \n        # An√°lisis de progresividad\n        correlacion <- cor(datos_plot$avaluo_medio, datos_plot$tarifa, method = \"spearman\")\n        n_intervalos <- nrow(datos_plot)\n        incrementos_positivos <- sum(diff(datos_plot$tarifa[order(datos_plot$avaluo_medio)]) > 0)\n        prop_progresiva <- round(incrementos_positivos / (n_intervalos - 1) * 100, 1)\n        \n        cat(\"\\n**An√°lisis estad√≠stico:**\\n\")\n        cat(\"- **N√∫mero de intervalos analizados:** \", n_intervalos, \"\\n\")\n        cat(\"- **Correlaci√≥n aval√∫o-tarifa (Spearman):** \", round(correlacion, 3), \"\\n\")\n        cat(\"- **Proporci√≥n de incrementos progresivos:** \", prop_progresiva, \"%\\n\")\n        \n        if (correlacion > 0.7) {\n          cat(\"- **Interpretaci√≥n:** Sistema altamente progresivo\\n\")\n        } else if (correlacion > 0.3) {\n          cat(\"- **Interpretaci√≥n:** Sistema moderadamente progresivo\\n\")\n        } else if (correlacion > -0.3) {\n          cat(\"- **Interpretaci√≥n:** Sistema con progresividad variable\\n\")\n        } else {\n          cat(\"- **Interpretaci√≥n:** Sistema con tendencia regresiva\\n\")\n        }\n        \n      } else {\n        cat(\"Datos insuficientes para generar an√°lisis de progresividad por aval√∫o.\\n\")\n      }\n      \n    } else {\n      cat(\"No se encontraron datos de aval√∫o para este municipio en los registros detallados.\\n\")\n    }\n    \n  }, error = function(e) {\n    cat(\"*No fue posible generar el an√°lisis de progresividad por aval√∫o para este municipio.*\\n\")\n    cat(\"*Motivo: Datos de transcripci√≥n no disponibles o incompletos.*\\n\")\n  })\n}\n```\n\n## Progresividad por √°rea\n\n```{r}\n#| echo: false\n#| results: asis\n#| fig-width: 10\n#| fig-height: 6\n\n# Verificar si existe la imagen ladder de √°rea\nimg_area <- paste0(\"img_estatutos/\", params$cod_dane, \"_ladder_area.png\")\n\nif (file.exists(img_area)) {\n  cat(\"El an√°lisis por √°rea eval√∫a la progresividad basada en la superficie construida:\\n\\n\")\n  cat(\"![Progresividad por √°rea](\", img_area, \"){width=90%}\\n\\n\")\n  cat(\"**Descripci√≥n:** Gr√°fico ladder que muestra la relaci√≥n entre rangos de √°rea construida (m¬≤) y las tarifas prediales en \", params$nombre, \".\\n\\n\")\n  cat(\"**Interpretaci√≥n:** Permite evaluar si el municipio penaliza o incentiva predios de mayor tama√±o. Una progresividad negativa podr√≠a indicar incentivos a la densificaci√≥n.\\n\\n\")\n} else {\n  # Generar gr√°fico din√°mico desde los datos\n  cat(\"### An√°lisis de progresividad por √°rea (generado din√°micamente)\\n\\n\")\n  \n  tryCatch({\n    bd_transcripciones <- lee_rds(\"ds_estatutos/BD_Transcripciones.rds\")\n    \n    # Filtrar datos del municipio con informaci√≥n de √°rea\n    datos_area <- bd_transcripciones %>%\n      filter(codigo_dane == params$cod_dane) %>%\n      filter(!is.na(area_desde) | !is.na(area_hasta)) %>%\n      filter(!is.na(tarifa))\n    \n    if (nrow(datos_area) > 0) {\n      library(ggplot2)\n      \n      # Preparar datos para gr√°fico\n      datos_plot_area <- datos_area %>%\n        mutate(\n          area_media = case_when(\n            !is.na(area_desde) & !is.na(area_hasta) ~ (area_desde + area_hasta) / 2,\n            !is.na(area_desde) ~ area_desde,\n            !is.na(area_hasta) ~ area_hasta,\n            TRUE ~ NA_real_\n          ),\n          area_desde = ifelse(is.na(area_desde), 0, area_desde),\n          area_hasta = ifelse(is.na(area_hasta), area_media * 2, area_hasta)\n        ) %>%\n        filter(!is.na(area_media), !is.na(tarifa), area_media > 0) %>%\n        arrange(area_media)\n      \n      if (nrow(datos_plot_area) >= 2) {\n        # Crear gr√°fico ladder para √°rea con mejoras visuales\n        p_area <- ggplot(datos_plot_area, aes(x = area_media, y = tarifa)) +\n          geom_step(direction = \"hv\", color = \"darkgreen\", size = 1.2, alpha = 0.8) +\n          geom_point(color = \"darkgreen\", size = 2.5, alpha = 0.9) +\n          geom_smooth(method = \"loess\", se = TRUE, color = \"orange\", alpha = 0.3, size = 0.8) +\n          scale_x_continuous(\n            trans = \"log10\",\n            labels = scales::comma_format(suffix = \" m¬≤\"),\n            name = \"√Årea construida (m¬≤, escala logar√≠tmica)\",\n            breaks = scales::trans_breaks(\"log10\", function(x) 10^x),\n            minor_breaks = scales::trans_breaks(\"log10\", function(x) 10^x, n = 10)\n          ) +\n          scale_y_continuous(\n            labels = scales::number_format(suffix = \"‚Ä∞\"),\n            name = \"Tarifa predial (por mil)\"\n          ) +\n          labs(\n            title = paste(\"Progresividad por √°rea construida -\", params$nombre),\n            subtitle = \"L√≠nea verde: escalones tarifarios | L√≠nea naranja: tendencia suavizada\",\n            caption = \"Fuente: An√°lisis de estatutos tributarios ‚Ä¢ Mayor √°rea ‚Üí ¬øMayor o menor tarifa?\"\n          ) +\n          theme_minimal() +\n          theme(\n            plot.title = element_text(size = 14, face = \"bold\", color = \"darkgreen\"),\n            plot.subtitle = element_text(size = 11, color = \"gray40\"),\n            plot.caption = element_text(size = 9, color = \"gray50\"),\n            axis.title = element_text(size = 11),\n            panel.grid.minor = element_blank(),\n            panel.grid.major = element_line(color = \"gray90\", size = 0.5)\n          )\n        \n        print(p_area)\n        \n        # An√°lisis de progresividad por √°rea mejorado\n        correlacion_area <- cor(datos_plot_area$area_media, datos_plot_area$tarifa, method = \"spearman\")\n        n_intervalos_area <- nrow(datos_plot_area)\n        tarifa_ordenada <- datos_plot_area$tarifa[order(datos_plot_area$area_media)]\n        incrementos_positivos_area <- sum(diff(tarifa_ordenada) > 0)\n        decrementos_area <- sum(diff(tarifa_ordenada) < 0)\n        prop_progresiva_area <- round(incrementos_positivos_area / (n_intervalos_area - 1) * 100, 1)\n        \n        # Calcular elasticidad √°rea-tarifa\n        if (length(datos_plot_area$area_media) > 2) {\n          modelo_area <- lm(log(tarifa) ~ log(area_media), data = datos_plot_area)\n          elasticidad_area <- round(coef(modelo_area)[2], 3)\n        } else {\n          elasticidad_area <- NA\n        }\n        \n        cat(\"\\n**An√°lisis estad√≠stico avanzado:**\\n\")\n        cat(\"- **N√∫mero de intervalos analizados:** \", n_intervalos_area, \"\\n\")\n        cat(\"- **Correlaci√≥n √°rea-tarifa (Spearman):** \", round(correlacion_area, 3), \"\\n\")\n        cat(\"- **Proporci√≥n de incrementos progresivos:** \", prop_progresiva_area, \"%\\n\")\n        cat(\"- **Incrementos vs. decrementos:** \", incrementos_positivos_area, \" vs \", decrementos_area, \"\\n\")\n        if (!is.na(elasticidad_area)) {\n          cat(\"- **Elasticidad √°rea-tarifa:** \", elasticidad_area, \"\\n\")\n        }\n        \n        if (correlacion_area > 0.3) {\n          cat(\"- **Interpretaci√≥n:** Las tarifas tienden a aumentar con el √°rea (penalizaci√≥n a predios grandes)\\n\")\n        } else if (correlacion_area < -0.3) {\n          cat(\"- **Interpretaci√≥n:** Las tarifas tienden a disminuir con el √°rea (incentivo a predios grandes)\\n\")\n        } else {\n          cat(\"- **Interpretaci√≥n:** Las tarifas no presentan una relaci√≥n clara con el √°rea\\n\")\n        }\n        \n        # Comparaci√≥n con aval√∫o (si disponible)\n        datos_avaluo_comp <- bd_transcripciones %>%\n          filter(codigo_dane == params$cod_dane) %>%\n          filter(!is.na(avaluo_desde) | !is.na(avaluo_hasta)) %>%\n          filter(!is.na(tarifa))\n        \n        if (nrow(datos_avaluo_comp) > 1) {\n          datos_avaluo_comp <- datos_avaluo_comp %>%\n            mutate(\n              avaluo_medio = case_when(\n                !is.na(avaluo_desde) & !is.na(avaluo_hasta) ~ (avaluo_desde + avaluo_hasta) / 2,\n                !is.na(avaluo_desde) ~ avaluo_desde,\n                !is.na(avaluo_hasta) ~ avaluo_hasta,\n                TRUE ~ NA_real_\n              )\n            ) %>%\n            filter(!is.na(avaluo_medio))\n          \n          if (nrow(datos_avaluo_comp) > 1) {\n            correlacion_avaluo_comp <- cor(datos_avaluo_comp$avaluo_medio, datos_avaluo_comp$tarifa, method = \"spearman\")\n            cat(\"- **Comparaci√≥n:** Correlaci√≥n aval√∫o-tarifa: \", round(correlacion_avaluo_comp, 3), \n                \" vs √°rea-tarifa: \", round(correlacion_area, 3), \"\\n\")\n            \n            if (abs(correlacion_area) > abs(correlacion_avaluo_comp)) {\n              cat(\"- **Observaci√≥n:** El √°rea parece ser un criterio m√°s determinante que el aval√∫o\\n\")\n            } else {\n              cat(\"- **Observaci√≥n:** El aval√∫o parece ser un criterio m√°s determinante que el √°rea\\n\")\n            }\n          }\n        }\n        \n      } else {\n        cat(\"Datos insuficientes para generar an√°lisis de progresividad por √°rea.\\n\")\n      }\n      \n    } else {\n      cat(\"No se encontraron datos de √°rea para este municipio en los registros detallados.\\n\")\n    }\n    \n  }, error = function(e) {\n    cat(\"*No fue posible generar el an√°lisis de progresividad por √°rea para este municipio.*\\n\")\n    cat(\"*Motivo: Datos de transcripci√≥n no disponibles o incompletos.*\\n\")\n  })\n}\n```\n\n# Contexto departamental\n\n```{r}\n#| echo: false\n#| results: asis\n\ncat(\"## Posici√≥n relativa en Antioquia\\n\\n\")\n\n# Generar estad√≠sticas comparativas\nif (nrow(datos_municipio) > 0) {\n  # Ranking por n√∫mero de reglas\n  ranking_reglas <- bd_estatutos %>%\n    count(codigo_dane, mpio, sort = TRUE) %>%\n    mutate(ranking = row_number()) %>%\n    filter(codigo_dane == params$cod_dane)\n  \n  if (nrow(ranking_reglas) > 0) {\n    total_municipios <- bd_estatutos %>% distinct(codigo_dane) %>% nrow()\n    cat(\"- **Ranking por complejidad normativa:** \", ranking_reglas$ranking, \" de \", total_municipios, \" municipios\\n\")\n    cat(\"- **N√∫mero de reglas:** \", ranking_reglas$n, \"\\n\")\n    \n    # Clasificaci√≥n\n    if (ranking_reglas$ranking <= total_municipios * 0.25) {\n      cat(\"- **Clasificaci√≥n:** Alta complejidad normativa (cuartil superior)\\n\")\n    } else if (ranking_reglas$ranking <= total_municipios * 0.5) {\n      cat(\"- **Clasificaci√≥n:** Complejidad normativa medio-alta\\n\")\n    } else if (ranking_reglas$ranking <= total_municipios * 0.75) {\n      cat(\"- **Clasificaci√≥n:** Complejidad normativa medio-baja\\n\")\n    } else {\n      cat(\"- **Clasificaci√≥n:** Baja complejidad normativa (cuartil inferior)\\n\")\n    }\n  }\n}\n\ncat(\"\\n\")\n\n# Enlaces a visualizaciones generales si existen\nimg_generales <- c(\n  \"tipologia_agregada.png\" = \"Tipolog√≠as agregadas del departamento\",\n  \"tipologia_todos.png\" = \"Complejidad normativa por municipio\",\n  \"map_rules_count.png\" = \"Mapa de complejidad normativa\",\n  \"tarifas_mapa_urbano.png\" = \"Mapa de tarifas urbanas\",\n  \"tarifas_mapa_rural.png\" = \"Mapa de tarifas rurales\"\n)\n\ncat(\"## Visualizaciones del contexto departamental\\n\\n\")\nfor (i in seq_along(img_generales)) {\n  img_path <- paste0(\"img_estatutos/\", names(img_generales)[i])\n  if (file.exists(img_path)) {\n    cat(\"- [\", img_generales[i], \"](\", img_path, \")\\n\")\n  }\n}\n```\n\n# Documentos de referencia\n\n```{r}\n#| echo: false\n#| results: asis\n\ncat(\"## Estatutos y documentos fuente\\n\\n\")\n\nif (nrow(freq_cat) > 0 && \"enlace_pdf\" %in% names(freq_cat)) {\n  enlaces_disponibles <- freq_cat %>% \n    filter(enlace_pdf != \"No disponible\") %>%\n    nrow()\n  \n  if (enlaces_disponibles > 0) {\n    cat(\"Se han identificado \", enlaces_disponibles, \" documentos fuente para este municipio. \")\n    cat(\"Los enlaces de descarga est√°n disponibles en la tabla de estatutos al inicio de este documento.\\n\\n\")\n  } else {\n    cat(\"Los documentos fuente est√°n en proceso de digitalizaci√≥n.\\n\\n\")\n  }\n} else {\n  cat(\"Los documentos fuente est√°n en proceso de digitalizaci√≥n.\\n\\n\")\n}\n\ncat(\"## Metodolog√≠a del an√°lisis\\n\\n\")\ncat(\"Este an√°lisis forma parte del proyecto de sistematizaci√≥n de estatutos tributarios de Antioquia, que incluye:\\n\\n\")\ncat(\"1. **Transcripci√≥n normativa:** Conversi√≥n de estatutos f√≠sicos a formato digital estructurado\\n\")\ncat(\"2. **Categorizaci√≥n:** Identificaci√≥n de criterios tarifarios (aval√∫o, √°rea, destino, estrato)\\n\")\ncat(\"3. **An√°lisis de progresividad:** Evaluaci√≥n de la coherencia y equidad del sistema tarifario\\n\")\ncat(\"4. **Comparaci√≥n intermunicipal:** Benchmarking con otros municipios del departamento\\n\\n\")\ncat(\"Para m√°s informaci√≥n sobre la metodolog√≠a completa, consulte el [an√°lisis departamental](estatuto_index.html).\\n\")\n```\n\n# Resumen visual integrado\n\n```{r}\n#| echo: false\n#| results: asis\n#| fig-width: 12\n#| fig-height: 8\n\n# Solo generar si hay datos de transcripciones\ntryCatch({\n  bd_transcripciones <- lee_rds(\"ds_estatutos/BD_Transcripciones.rds\")\n  datos_resumen <- bd_transcripciones %>%\n    filter(codigo_dane == params$cod_dane)\n  \n  if (nrow(datos_resumen) > 0) {\n    cat(\"## Dashboard de an√°lisis tributario\\n\\n\")\n    cat(\"Este resumen integra los principales hallazgos del an√°lisis tributario de \", params$nombre, \":\\n\\n\")\n    \n    # Crear un layout de m√∫ltiples gr√°ficos si hay suficientes datos\n    tryCatch({\n      library(gridExtra)\n      library(grid)\n      use_grid <- TRUE\n    }, error = function(e) {\n      use_grid <- FALSE\n    })\n    \n    plots_list <- list()\n    \n    # 1. Gr√°fico de tarifas mejorado con box plot y violin plot\n    datos_tarifas_res <- datos_resumen %>% filter(!is.na(tarifa), tarifa > 0)\n    if (nrow(datos_tarifas_res) > 1) {\n      p1 <- ggplot(datos_tarifas_res, aes(x = \"\", y = tarifa)) +\n        geom_violin(fill = \"lightblue\", alpha = 0.5, color = \"blue\") +\n        geom_boxplot(fill = \"lightblue\", alpha = 0.8, width = 0.3, \n                     outlier.color = \"red\", outlier.size = 2) +\n        geom_jitter(width = 0.1, alpha = 0.6, color = \"darkblue\", size = 1.5) +\n        stat_summary(fun = mean, geom = \"point\", shape = 18, size = 4, color = \"orange\") +\n        labs(\n          title = \"Distribuci√≥n de tarifas\", \n          subtitle = paste(\"üîµ Datos | üì¶ Cuartiles | üü† Promedio | üî¥ Outliers\"),\n          y = \"Tarifa (‚Ä∞)\", \n          x = \"\"\n        ) +\n        theme_minimal() +\n        theme(\n          plot.title = element_text(size = 12, face = \"bold\"),\n          plot.subtitle = element_text(size = 9, color = \"gray50\"),\n          axis.text.x = element_blank(),\n          axis.ticks.x = element_blank()\n        )\n      plots_list <- append(plots_list, list(p1))\n    }\n    \n    # 2. Gr√°fico de progresividad por aval√∫o si hay datos\n    datos_avaluo_res <- datos_resumen %>%\n      filter(!is.na(avaluo_desde) | !is.na(avaluo_hasta)) %>%\n      filter(!is.na(tarifa)) %>%\n      mutate(\n        avaluo_medio = case_when(\n          !is.na(avaluo_desde) & !is.na(avaluo_hasta) ~ (avaluo_desde + avaluo_hasta) / 2,\n          !is.na(avaluo_desde) ~ avaluo_desde,\n          !is.na(avaluo_hasta) ~ avaluo_hasta,\n          TRUE ~ NA_real_\n        )\n      ) %>%\n      filter(!is.na(avaluo_medio)) %>%\n      arrange(avaluo_medio)\n    \n    if (nrow(datos_avaluo_res) >= 3) {\n      # Calcular R¬≤ para mostrar calidad del ajuste\n      modelo_temp <- lm(tarifa ~ log10(avaluo_medio), data = datos_avaluo_res)\n      r_squared <- round(summary(modelo_temp)$r.squared, 3)\n      \n      p2 <- ggplot(datos_avaluo_res, aes(x = avaluo_medio, y = tarifa)) +\n        geom_point(aes(size = avaluo_medio), color = \"darkblue\", alpha = 0.7) +\n        geom_smooth(method = \"lm\", se = TRUE, color = \"red\", linetype = \"dashed\", alpha = 0.3) +\n        geom_smooth(method = \"loess\", se = FALSE, color = \"green\", size = 1, alpha = 0.8) +\n        scale_x_continuous(\n          trans = \"log10\", \n          labels = scales::comma_format(scale = 1e-6, suffix = \"M\"),\n          breaks = scales::trans_breaks(\"log10\", function(x) 10^x, n = 4)\n        ) +\n        scale_size_continuous(guide = \"none\", range = c(1, 4)) +\n        labs(\n          title = \"Progresividad por aval√∫o\", \n          subtitle = paste(\"üî¥ Tendencia lineal (R¬≤=\", r_squared, \") | üü¢ Tendencia suavizada\"),\n          x = \"Aval√∫o (UVT)\", \n          y = \"Tarifa (‚Ä∞)\"\n        ) +\n        theme_minimal() +\n        theme(\n          plot.title = element_text(size = 12, face = \"bold\"),\n          plot.subtitle = element_text(size = 9, color = \"gray50\")\n        )\n      plots_list <- append(plots_list, list(p2))\n    }\n    \n    # 3. Gr√°fico de criterios utilizados\n    criterios_summary <- datos_resumen %>%\n      summarise(\n        Aval√∫o = sum(!is.na(avaluo_desde) | !is.na(avaluo_hasta)),\n        √Årea = sum(!is.na(area_desde) | !is.na(area_hasta)),\n        Destino = sum(!is.na(destino) & destino != \"\", na.rm = TRUE),\n        Estrato = sum(!is.na(estrato) & estrato != \"\", na.rm = TRUE),\n        Zona = sum(!is.na(zona) & zona != \"\", na.rm = TRUE)\n      ) %>%\n      tidyr::pivot_longer(everything(), names_to = \"Criterio\", values_to = \"Frecuencia\") %>%\n      filter(Frecuencia > 0)\n    \n    if (nrow(criterios_summary) > 0) {\n      p3 <- ggplot(criterios_summary, aes(x = reorder(Criterio, Frecuencia), y = Frecuencia)) +\n        geom_col(fill = \"darkgreen\", alpha = 0.7) +\n        coord_flip() +\n        labs(title = \"Criterios utilizados\", x = \"Criterio\", y = \"N√∫mero de reglas\") +\n        theme_minimal() +\n        theme(plot.title = element_text(size = 12, face = \"bold\"))\n      plots_list <- append(plots_list, list(p3))\n    }\n    \n    # Mostrar gr√°ficos\n    if (length(plots_list) > 0) {\n      if (use_grid && length(plots_list) > 1) {\n        # Usar grid si est√° disponible\n        if (length(plots_list) == 2) {\n          grid.arrange(grobs = plots_list, ncol = 2)\n        } else if (length(plots_list) >= 3) {\n          grid.arrange(grobs = plots_list, ncol = 2, nrow = 2)\n        }\n      } else {\n        # Mostrar gr√°ficos individualmente\n        for (i in seq_along(plots_list)) {\n          print(plots_list[[i]])\n        }\n      }\n      \n      cat(\"\\n**üéØ Interpretaci√≥n integral del dashboard:**\\n\")\n      cat(\"Este dashboard proporciona una **visi√≥n 360¬∞ del sistema tributario** de \", params$nombre, \", integrando m√∫ltiples dimensiones anal√≠ticas:\\n\\n\")\n      \n      # An√°lisis integrado m√°s sofisticado\n      cat(\"**üìä Resumen ejecutivo:**\\n\")\n      total_reglas <- nrow(datos_resumen)\n      complejidad_score <- 0\n      \n      # Calcular score de complejidad\n      if (nrow(criterios_summary) > 0) {\n        complejidad_score <- complejidad_score + (nrow(criterios_summary) * 20)\n      }\n      if (nrow(datos_tarifas_res) > 0) {\n        n_tarifas_unicas <- length(unique(datos_tarifas_res$tarifa))\n        complejidad_score <- complejidad_score + min(n_tarifas_unicas * 5, 50)\n        cv_tarifas <- sd(datos_tarifas_res$tarifa) / mean(datos_tarifas_res$tarifa)\n        if (cv_tarifas > 0.5) complejidad_score <- complejidad_score + 30\n      }\n      \n      cat(\"- **üìà Complejidad normativa:** \")\n      if (complejidad_score >= 80) {\n        cat(\"ALTA (score: \", complejidad_score, \") - Sistema muy sofisticado\\n\")\n      } else if (complejidad_score >= 50) {\n        cat(\"MODERADA (score: \", complejidad_score, \") - Sistema equilibrado\\n\")\n      } else {\n        cat(\"BAJA (score: \", complejidad_score, \") - Sistema simplificado\\n\")\n      }\n      \n      cat(\"- **üî¢ Total de reglas analizadas:** \", total_reglas, \"\\n\")\n      \n      if (nrow(datos_tarifas_res) > 0) {\n        tarifa_promedio <- round(mean(datos_tarifas_res$tarifa), 2)\n        tarifa_mediana <- round(median(datos_tarifas_res$tarifa), 2)\n        dispersion <- round(sd(datos_tarifas_res$tarifa) / mean(datos_tarifas_res$tarifa), 3)\n        \n        cat(\"- **üí∞ Estructura tarifaria:**\\n\")\n        cat(\"  - Tarifas √∫nicas: \", length(unique(datos_tarifas_res$tarifa)), \"\\n\")\n        cat(\"  - Tarifa t√≠pica: \", tarifa_mediana, \"‚Ä∞ (mediana)\\n\")\n        cat(\"  - Rango: \", min(datos_tarifas_res$tarifa), \"‚Ä∞ - \", max(datos_tarifas_res$tarifa), \"‚Ä∞\\n\")\n        cat(\"  - Uniformidad: \", if(dispersion < 0.3) \"Alta\" else if(dispersion < 0.7) \"Moderada\" else \"Baja\", \" (CV: \", dispersion, \")\\n\")\n      }\n      \n      if (nrow(criterios_summary) > 0) {\n        criterio_principal <- criterios_summary$Criterio[which.max(criterios_summary$Frecuencia)]\n        cat(\"- **üéØ Criterios tarifarios activos:** \", nrow(criterios_summary), \"\\n\")\n        cat(\"  - Criterio principal: \", criterio_principal, \" (\", max(criterios_summary$Frecuencia), \" reglas)\\n\")\n      }\n      \n      # An√°lisis de progresividad si hay datos de aval√∫o\n      if (nrow(datos_avaluo_res) >= 3) {\n        cor_avaluo <- cor(datos_avaluo_res$avaluo_medio, datos_avaluo_res$tarifa, method = \"spearman\")\n        cat(\"- **üìà Progresividad por aval√∫o:** \")\n        if (cor_avaluo > 0.7) {\n          cat(\"ALTA (r=\", round(cor_avaluo, 2), \") - Sistema muy progresivo\\n\")\n        } else if (cor_avaluo > 0.3) {\n          cat(\"MODERADA (r=\", round(cor_avaluo, 2), \") - Progresividad parcial\\n\")\n        } else if (cor_avaluo > -0.3) {\n          cat(\"VARIABLE (r=\", round(cor_avaluo, 2), \") - Sin patr√≥n claro\\n\")\n        } else {\n          cat(\"REGRESIVA (r=\", round(cor_avaluo, 2), \") - Tarifa decrece con aval√∫o\\n\")\n        }\n      }\n      \n      cat(\"\\n**üîç Recomendaciones basadas en el an√°lisis:**\\n\")\n      if (complejidad_score >= 80) {\n        cat(\"- Considerar **simplificaci√≥n** del esquema tarifario\\n\")\n        cat(\"- Implementar **herramientas digitales** para facilitar aplicaci√≥n\\n\")\n      } else if (complejidad_score < 30) {\n        cat(\"- Evaluar si el esquema actual **captura adecuadamente** la capacidad contributiva\\n\")\n        cat(\"- Considerar mayor **diferenciaci√≥n** tarifaria si es viable\\n\")\n      } else {\n        cat(\"- Mantener **equilibrio actual** entre simplicidad y equidad\\n\")\n        cat(\"- Realizar **revisiones peri√≥dicas** del esquema\\n\")\n      }\n      \n      if (nrow(datos_tarifas_res) > 0 && sd(datos_tarifas_res$tarifa) / mean(datos_tarifas_res$tarifa) > 1) {\n        cat(\"- **Alta dispersi√≥n** detectada: revisar coherencia entre tarifas\\n\")\n      }\n    }\n    \n  } else {\n    cat(\"No hay suficientes datos para generar el dashboard visual.\\n\")\n  }\n  \n}, error = function(e) {\n  cat(\"*Dashboard visual no disponible para este municipio.*\\n\")\n})\n```\n\n# Estad√≠sticas avanzadas del municipio\n\n```{r}\n#| echo: false\n#| results: asis\n\nif (nrow(datos_municipio) > 0) {\n  cat(\"## An√°lisis temporal de la normativa\\n\\n\")\n  \n  # An√°lisis temporal si hay datos de a√±o\n  if (\"anio\" %in% names(datos_municipio) && any(!is.na(datos_municipio$anio))) {\n    # Evoluci√≥n temporal\n    evolucion <- datos_municipio %>%\n      filter(!is.na(anio)) %>%\n      count(anio, sort = TRUE)\n    \n    if (nrow(evolucion) > 1) {\n      cat(\"### Evoluci√≥n de la actividad normativa\\n\\n\")\n      anos_activos <- evolucion$anio\n      cat(\"- **A√±os con mayor actividad normativa:** \", paste(head(anos_activos, 3), collapse = \", \"), \"\\n\")\n      cat(\"- **Per√≠odo de mayor estabilidad:** \")\n      \n      # Buscar per√≠odos sin cambios\n      gaps <- diff(anos_activos)\n      if (any(gaps > 1)) {\n        cat(\"Se observan per√≠odos de estabilidad normativa entre algunos a√±os\\n\")\n      } else {\n        cat(\"Actividad normativa continua en el per√≠odo analizado\\n\")\n      }\n      \n      # Tabla de evoluci√≥n\n      cat(\"\\n\")\n      kable(evolucion, \n            col.names = c(\"A√±o\", \"N√∫mero de registros\"),\n            caption = \"Evoluci√≥n temporal de la normativa tributaria\")\n      cat(\"\\n\")\n    }\n  }\n  \n  # An√°lisis de tipos de normativa\n  if (\"tipo\" %in% names(datos_municipio) && any(!is.na(datos_municipio$tipo))) {\n    cat(\"## Tipolog√≠a normativa\\n\\n\")\n    \n    tipos_freq <- datos_municipio %>%\n      filter(!is.na(tipo)) %>%\n      count(tipo, sort = TRUE)\n    \n    if (nrow(tipos_freq) > 0) {\n      cat(\"### Distribuci√≥n por tipo de normativa\\n\\n\")\n      kable(tipos_freq, \n            col.names = c(\"Tipo de normativa\", \"Frecuencia\"),\n            caption = \"Tipos de instrumentos normativos utilizados\")\n      cat(\"\\n\")\n      \n      tipo_principal <- tipos_freq$tipo[1]\n      freq_principal <- tipos_freq$n[1]\n      porcentaje_principal <- round((freq_principal / nrow(datos_municipio)) * 100, 1)\n      \n      cat(\"- **Instrumento normativo predominante:** \", tipo_principal, \n          \" (\", freq_principal, \" registros, \", porcentaje_principal, \"%)\\n\")\n    }\n  }\n  \n  # Comparaci√≥n con promedios departamentales\n  cat(\"## Comparaci√≥n departamental\\n\\n\")\n  \n  # Estad√≠sticas departamentales\n  stats_dpto <- bd_estatutos %>%\n    group_by(codigo_dane) %>%\n    summarise(\n      total_registros = n(),\n      .groups = 'drop'\n    )\n  \n  promedio_dpto <- mean(stats_dpto$total_registros, na.rm = TRUE)\n  mediana_dpto <- median(stats_dpto$total_registros, na.rm = TRUE)\n  \n  registros_municipio <- nrow(datos_municipio)\n  \n  cat(\"- **Registros de este municipio:** \", registros_municipio, \"\\n\")\n  cat(\"- **Promedio departamental:** \", round(promedio_dpto, 1), \"\\n\")\n  cat(\"- **Mediana departamental:** \", round(mediana_dpto, 1), \"\\n\")\n  \n  # Clasificaci√≥n relativa\n  if (registros_municipio > promedio_dpto) {\n    cat(\"- **Clasificaci√≥n:** Por encima del promedio departamental (\", \n        round((registros_municipio - promedio_dpto) / promedio_dpto * 100, 1), \n        \"% m√°s registros)\\n\")\n  } else {\n    cat(\"- **Clasificaci√≥n:** Por debajo del promedio departamental (\", \n        round((promedio_dpto - registros_municipio) / promedio_dpto * 100, 1), \n        \"% menos registros)\\n\")\n  }\n  \n  # Percentil\n  percentil <- round(sum(stats_dpto$total_registros <= registros_municipio) / nrow(stats_dpto) * 100, 1)\n  cat(\"- **Percentil departamental:** \", percentil, \"% (\", \n      round(100 - percentil, 1), \"% de municipios tienen m√°s registros)\\n\")\n\n} else {\n  cat(\"No hay datos suficientes para generar estad√≠sticas avanzadas.\\n\")\n}\n```\n\n# Recomendaciones espec√≠ficas\n\n```{r}\n#| echo: false\n#| results: asis\n\nif (nrow(datos_municipio) > 0) {\n  cat(\"## Recomendaciones de pol√≠tica tributaria\\n\\n\")\n  \n  # Generar recomendaciones basadas en las caracter√≠sticas del municipio\n  registros_municipio <- nrow(datos_municipio)\n  \n  # Obtener estad√≠sticas para comparaci√≥n\n  stats_dpto <- bd_estatutos %>%\n    group_by(codigo_dane) %>%\n    summarise(total_registros = n(), .groups = 'drop')\n  \n  promedio_dpto <- mean(stats_dpto$total_registros, na.rm = TRUE)\n  cuartil_superior <- quantile(stats_dpto$total_registros, 0.75, na.rm = TRUE)\n  cuartil_inferior <- quantile(stats_dpto$total_registros, 0.25, na.rm = TRUE)\n  \n  cat(\"Bas√°ndose en el an√°lisis comparativo, se sugieren las siguientes recomendaciones:\\n\\n\")\n  \n  if (registros_municipio > cuartil_superior) {\n    cat(\"### Simplificaci√≥n normativa (Alta complejidad)\\n\\n\")\n    cat(\"- **Revisi√≥n integral:** Considerar la consolidaci√≥n de reglas similares para reducir complejidad administrativa\\n\")\n    cat(\"- **Digitalizaci√≥n:** Implementar herramientas digitales para facilitar el c√°lculo y aplicaci√≥n de tarifas\\n\")\n    cat(\"- **Capacitaci√≥n:** Fortalecer las competencias t√©cnicas del personal tributario\\n\")\n    cat(\"- **Comunicaci√≥n:** Desarrollar material did√°ctico para facilitar el entendimiento ciudadano\\n\\n\")\n  } else if (registros_municipio < cuartil_inferior) {\n    cat(\"### Optimizaci√≥n del potencial tributario (Baja complejidad)\\n\\n\")\n    cat(\"- **An√°lisis de brechas:** Evaluar si la simplicidad actual captura adecuadamente la capacidad contributiva\\n\")\n    cat(\"- **Benchmarking:** Considerar mejores pr√°cticas de municipios similares\\n\")\n    cat(\"- **Progresividad:** Evaluar la implementaci√≥n de esquemas m√°s progresivos si es t√©cnicamente viable\\n\")\n    cat(\"- **Actualizaci√≥n:** Revisar la vigencia y pertinencia de las tarifas actuales\\n\\n\")\n  } else {\n    cat(\"### Optimizaci√≥n del esquema actual (Complejidad media)\\n\\n\")\n    cat(\"- **Eficiencia:** Evaluar la efectividad del esquema actual en t√©rminos de recaudo y equidad\\n\")\n    cat(\"- **Actualizaci√≥n peri√≥dica:** Establecer cronogramas regulares de revisi√≥n normativa\\n\")\n    cat(\"- **Monitoreo:** Implementar indicadores de seguimiento a la aplicaci√≥n de tarifas\\n\")\n    cat(\"- **Participaci√≥n:** Involucrar a la ciudadan√≠a en procesos de actualizaci√≥n normativa\\n\\n\")\n  }\n  \n  cat(\"### Recomendaciones generales\\n\\n\")\n  cat(\"- **Transparencia:** Publicar de manera clara y accesible todas las tarifas vigentes\\n\")\n  cat(\"- **Tecnolog√≠a:** Aprovechar herramientas digitales para mejorar la gesti√≥n tributaria\\n\")\n  cat(\"- **Equidad:** Evaluar peri√≥dicamente el impacto distributivo del sistema tarifario\\n\")\n  cat(\"- **Coordinaci√≥n:** Mantener coherencia con las pol√≠ticas tributarias departamentales\\n\\n\")\n  \n} else {\n  cat(\"Para generar recomendaciones espec√≠ficas se requieren datos adicionales del municipio.\\n\")\n}\n```","srcMarkdownNoYaml":"\n\n\nEste proyecto presenta un an√°lisis exhaustivo de los estatutos tributarios del municipio de \nPara el an√°lisis del municipio de , enfoc√°ndose espec√≠ficamente en la estructura del impuesto predial. El estatuto fue acompa√±ado de un an√°lisis jur√≠dico y de contenido detallado del cap√≠tulo de impuestos prediales contenido en sus estatutos de rentas.\n\nPara el an√°lisis del municipio se tuvieron  en cuenta los siguientes estatutos y modificaciones:\n\n```{r}\n#| echo: false\n#| message: false\n#| warning: false\n\n# Funci√≥n para leer archivos RDS con rutas relativas\nlee_rds <- function(rel){\n  candidatos <- c(rel, file.path('..', rel), file.path('..','..', rel))\n  existente <- candidatos[file.exists(candidatos)][1]\n  if(is.na(existente)) stop('No se encontr√≥ ', rel, ' en rutas: ', paste(candidatos, collapse=', '))\n  readRDS(existente)\n}\n\n# Cargar librer√≠as necesarias\nlibrary(dplyr)\nlibrary(knitr)\nlibrary(ggplot2)\nlibrary(scales)\nsuppressPackageStartupMessages({\n  library(gridExtra, quietly = TRUE)\n  library(grid, quietly = TRUE)\n  library(tidyr, quietly = TRUE)\n})\n\n# Configurar opciones de gr√°ficos\noptions(scipen = 999)  # Evitar notaci√≥n cient√≠fica\n\n# Cargar datos completos con manejo de ausencia del archivo\ndatos_disponibles <- TRUE\nbd_estatutos <- NULL\ntryCatch({\n  bd_estatutos <- lee_rds(\"ds_estatutos/BD_Estatutos.rds\")\n}, error = function(e){\n  datos_disponibles <<- FALSE\n  mensaje <- paste0(\"‚ö†Ô∏è No se encontr√≥ el dataset 'BD_Estatutos.rds'. Se mostrar√° una versi√≥n reducida del informe. Detalle: \", e$message)\n  message(mensaje)\n  cat(mensaje, \"\\n\\n\")\n})\n\n# Filtrar para el municipio espec√≠fico (si hay datos)\nif (datos_disponibles) {\n  datos_municipio <- bd_estatutos %>% filter(codigo_dane == params$cod_dane)\n} else {\n  datos_municipio <- data.frame()\n}\n\n# Tabla de estatutos\nfreq_cat <- datos_municipio %>%\n  mutate(\n    filename = if ('filename' %in% names(cur_data_all())) filename else NA_character_,\n    enlace_pdf = if_else(!is.na(filename) & filename != \"\", \n                         paste0(\"[Descargar PDF](pdfs/\", filename, \")\"), \n                         \"No disponible\")\n  ) %>%\n  select(any_of(c(\"mpio\",\"anio\",\"tipo\",\"numero\",\"observaciones\",\"enlace_pdf\")))\n\nif (nrow(freq_cat) == 0) {\n  cat(\"No hay estatutos registrados para este municipio.\\n\")\n} else {\n  knitr::kable(head(freq_cat, 200), caption = \"Estatutos Usados para el Estudio\", escape = FALSE)\n}\n```\n\n\nPara ver m√°s an√°lisis agregados y los detalles metodol√≥gicos puede visitar este enlace [(ir)](https://jcmunozmora.github.io/estatutos_analisis/).\n\n# Estad√≠sticas del municipio\n\n```{r}\n#| echo: false\n#| message: false\n#| warning: false\n\nif (nrow(datos_municipio) > 0) {\n  # Estad√≠sticas b√°sicas\n  cat(\"## Resumen estad√≠stico\\n\\n\")\n  cat(\"- **Total de registros analizados:** \", nrow(datos_municipio), \"\\n\")\n  \n  if (\"anio\" %in% names(datos_municipio)) {\n    anos_unicos <- sort(unique(datos_municipio$anio[!is.na(datos_municipio$anio)]))\n    if (length(anos_unicos) > 0) {\n      cat(\"- **Per√≠odo analizado:** \", min(anos_unicos), \" - \", max(anos_unicos), \"\\n\")\n      cat(\"- **A√±os con estatutos:** \", paste(anos_unicos, collapse = \", \"), \"\\n\")\n    }\n  }\n  \n  if (\"tipo\" %in% names(datos_municipio)) {\n    tipos_unicos <- unique(datos_municipio$tipo[!is.na(datos_municipio$tipo)])\n    if (length(tipos_unicos) > 0) {\n      cat(\"- **Tipos de normativa:** \", paste(tipos_unicos, collapse = \", \"), \"\\n\")\n    }\n  }\n  \n  # Comparaci√≥n con el departamento\n  total_departamento <- nrow(bd_estatutos)\n  porcentaje <- round((nrow(datos_municipio) / total_departamento) * 100, 2)\n  cat(\"- **Representaci√≥n en el estudio:** \", porcentaje, \"% del total departamental\\n\")\n  \n} else {\n  cat(\"No hay datos disponibles para generar estad√≠sticas.\\n\")\n}\n```\n\n# An√°lisis de estructura tarifaria\n\n## Combinaciones de criterios tarifarios\n\n```{r}\n#| echo: false\n#| results: asis\n#| fig-width: 10\n#| fig-height: 6\n\n# Verificar si existe la imagen de combinaciones para este municipio\nimg_combos <- paste0(\"img_estatutos/\", params$cod_dane, \"_combos.png\")\n\nif (file.exists(img_combos)) {\n  cat(\"Este gr√°fico muestra las diferentes combinaciones de criterios utilizados en la estructura tarifaria del municipio:\\n\\n\")\n  cat(\"![Combinaciones de criterios tarifarios](\", img_combos, \"){width=90%}\\n\\n\")\n  cat(\"**Descripci√≥n:** Visualizaci√≥n de las combinaciones de criterios (aval√∫o, √°rea, destino, estrato, etc.) utilizadas para determinar las tarifas prediales en \", params$nombre, \".\\n\\n\")\n  cat(\"**Interpretaci√≥n:** Cada combinaci√≥n representa una regla espec√≠fica del estatuto tributario. Mayor n√∫mero de combinaciones indica mayor complejidad normativa.\\n\\n\")\n} else {\n  # Generar an√°lisis din√°mico desde los datos\n  cat(\"### An√°lisis de criterios tarifarios (generado din√°micamente)\\n\\n\")\n  \n  tryCatch({\n    bd_transcripciones <- lee_rds(\"ds_estatutos/BD_Transcripciones.rds\")\n    \n    # Filtrar datos del municipio\n    datos_criterios <- bd_transcripciones %>%\n      filter(codigo_dane == params$cod_dane)\n    \n    if (nrow(datos_criterios) > 0) {\n      library(ggplot2)\n      library(dplyr)\n      \n      # Analizar qu√© criterios se utilizan\n      criterios_utilizados <- datos_criterios %>%\n        summarise(\n          usa_avaluo = any(!is.na(avaluo_desde) | !is.na(avaluo_hasta)),\n          usa_area = any(!is.na(area_desde) | !is.na(area_hasta)),\n          usa_destino = any(!is.na(destino) & destino != \"\"),\n          usa_estrato = any(!is.na(estrato) & estrato != \"\"),\n          usa_zona = any(!is.na(zona) & zona != \"\")\n        )\n      \n      # Crear resumen de criterios\n      criterios_activos <- c()\n      if (criterios_utilizados$usa_avaluo) criterios_activos <- c(criterios_activos, \"Aval√∫o\")\n      if (criterios_utilizados$usa_area) criterios_activos <- c(criterios_activos, \"√Årea\")\n      if (criterios_utilizados$usa_destino) criterios_activos <- c(criterios_activos, \"Destino\")\n      if (criterios_utilizados$usa_estrato) criterios_activos <- c(criterios_activos, \"Estrato\")\n      if (criterios_utilizados$usa_zona) criterios_activos <- c(criterios_activos, \"Zona\")\n      \n      cat(\"**Criterios tarifarios identificados:**\\n\")\n      if (length(criterios_activos) > 0) {\n        for (criterio in criterios_activos) {\n          cat(\"- ‚úì \", criterio, \"\\n\")\n        }\n      } else {\n        cat(\"- No se identificaron criterios espec√≠ficos en los datos disponibles\\n\")\n      }\n      cat(\"\\n\")\n      \n      # An√°lisis de combinaciones m√°s frecuentes\n      if (length(criterios_activos) > 1) {\n        # Crear combinaciones de criterios\n        combinaciones <- datos_criterios %>%\n          mutate(\n            combinacion = paste(\n              ifelse(!is.na(avaluo_desde) | !is.na(avaluo_hasta), \"Aval√∫o\", \"\"),\n              ifelse(!is.na(area_desde) | !is.na(area_hasta), \"√Årea\", \"\"),\n              ifelse(!is.na(destino) & destino != \"\", \"Destino\", \"\"),\n              ifelse(!is.na(estrato) & estrato != \"\", \"Estrato\", \"\"),\n              ifelse(!is.na(zona) & zona != \"\", \"Zona\", \"\"),\n              sep = \"+\"\n            )\n          ) %>%\n          mutate(combinacion = gsub(\"\\\\+{2,}\", \"+\", combinacion)) %>%\n          mutate(combinacion = gsub(\"^\\\\+|\\\\+$\", \"\", combinacion)) %>%\n          filter(combinacion != \"\") %>%\n          count(combinacion, sort = TRUE)\n        \n        if (nrow(combinaciones) > 0) {\n          cat(\"**Combinaciones de criterios m√°s frecuentes:**\\n\")\n          for (i in 1:min(5, nrow(combinaciones))) {\n            cat(\"- \", combinaciones$combinacion[i], \": \", combinaciones$n[i], \" reglas\\n\")\n          }\n          cat(\"\\n\")\n          \n          # Gr√°fico de barras de combinaciones\n          if (nrow(combinaciones) > 1) {\n            p_combos <- ggplot(head(combinaciones, 10), aes(x = reorder(combinacion, n), y = n)) +\n              geom_col(fill = \"steelblue\", alpha = 0.8) +\n              coord_flip() +\n              labs(\n                title = paste(\"Combinaciones de criterios tarifarios -\", params$nombre),\n                subtitle = \"Top 10 combinaciones m√°s utilizadas\",\n                x = \"Combinaci√≥n de criterios\",\n                y = \"N√∫mero de reglas\",\n                caption = \"Fuente: An√°lisis de estatutos tributarios\"\n              ) +\n              theme_minimal() +\n              theme(\n                plot.title = element_text(size = 14, face = \"bold\"),\n                plot.subtitle = element_text(size = 12),\n                axis.title = element_text(size = 11)\n              )\n            \n            print(p_combos)\n          }\n        }\n      }\n      \n      # Estad√≠sticas de complejidad\n      cat(\"\\n**An√°lisis de complejidad normativa:**\\n\")\n      cat(\"- **Total de reglas analizadas:** \", nrow(datos_criterios), \"\\n\")\n      cat(\"- **N√∫mero de criterios utilizados:** \", length(criterios_activos), \"\\n\")\n      \n      if (length(criterios_activos) >= 3) {\n        cat(\"- **Clasificaci√≥n:** Sistema de alta complejidad (m√∫ltiples criterios)\\n\")\n      } else if (length(criterios_activos) == 2) {\n        cat(\"- **Clasificaci√≥n:** Sistema de complejidad moderada\\n\")\n      } else {\n        cat(\"- **Clasificaci√≥n:** Sistema de baja complejidad (criterio √∫nico o simple)\\n\")\n      }\n      \n    } else {\n      cat(\"No se encontraron datos de criterios tarifarios para este municipio.\\n\")\n    }\n    \n  }, error = function(e) {\n    cat(\"*No fue posible generar el an√°lisis de criterios tarifarios para este municipio.*\\n\")\n    cat(\"*Motivo: Datos de transcripci√≥n no disponibles o incompletos.*\\n\")\n  })\n}\n```\n\n## Distribuci√≥n de tarifas\n\n```{r}\n#| echo: false\n#| results: asis\n#| fig-width: 10\n#| fig-height: 6\n\n# Verificar si existe la imagen de distribuci√≥n de tarifas\nimg_tarifas <- paste0(\"img_estatutos/\", params$cod_dane, \"_dist_tarifas.png\")\n\nif (file.exists(img_tarifas)) {\n  cat(\"La distribuci√≥n de tarifas muestra el rango y frecuencia de las diferentes tarifas prediales establecidas:\\n\\n\")\n  cat(\"![Distribuci√≥n de tarifas prediales](\", img_tarifas, \"){width=90%}\\n\\n\")\n  cat(\"**Descripci√≥n:** Histograma que muestra la distribuci√≥n de las tarifas prediales por mil (‚Ä∞) establecidas en el estatuto de \", params$nombre, \".\\n\\n\")\n  cat(\"**Interpretaci√≥n:** La forma de la distribuci√≥n indica si el municipio tiende hacia tarifas uniformes (distribuci√≥n concentrada) o hacia un esquema m√°s diversificado (distribuci√≥n dispersa).\\n\\n\")\n} else {\n  # Generar gr√°fico din√°mico desde los datos\n  cat(\"### Distribuci√≥n de tarifas prediales (generado din√°micamente)\\n\\n\")\n  \n  tryCatch({\n    bd_transcripciones <- lee_rds(\"ds_estatutos/BD_Transcripciones.rds\")\n    \n    # Filtrar datos del municipio\n    datos_tarifas <- bd_transcripciones %>%\n      filter(codigo_dane == params$cod_dane) %>%\n      filter(!is.na(tarifa), tarifa > 0)\n    \n    if (nrow(datos_tarifas) > 0) {\n      library(ggplot2)\n      \n      # Crear histograma de distribuci√≥n de tarifas mejorado\n      p_dist <- ggplot(datos_tarifas, aes(x = tarifa)) +\n        geom_histogram(aes(y = after_stat(density)), \n                       bins = min(30, max(5, nrow(datos_tarifas)/3)), \n                       fill = \"lightblue\", color = \"darkblue\", alpha = 0.7, size = 0.3) +\n        geom_density(alpha = 0.3, fill = \"blue\", color = \"blue\", size = 1) +\n        geom_vline(aes(xintercept = median(tarifa)), \n                   color = \"red\", linetype = \"dashed\", size = 1.2) +\n        geom_vline(aes(xintercept = mean(tarifa)), \n                   color = \"orange\", linetype = \"dashed\", size = 1.2) +\n        geom_vline(aes(xintercept = quantile(tarifa, 0.25)), \n                   color = \"purple\", linetype = \"dotted\", size = 0.8, alpha = 0.7) +\n        geom_vline(aes(xintercept = quantile(tarifa, 0.75)), \n                   color = \"purple\", linetype = \"dotted\", size = 0.8, alpha = 0.7) +\n        scale_x_continuous(\n          labels = scales::number_format(suffix = \"‚Ä∞\"),\n          name = \"Tarifa predial (por mil)\"\n        ) +\n        scale_y_continuous(\n          name = \"Densidad de probabilidad\",\n          labels = scales::number_format(accuracy = 0.01)\n        ) +\n        labs(\n          title = paste(\"Distribuci√≥n de tarifas prediales -\", params$nombre),\n          subtitle = \"üî¥ Mediana | üü† Promedio | üü£ Cuartiles (P25, P75) | üîµ Curva de densidad\",\n          caption = \"An√°lisis de concentraci√≥n y dispersi√≥n tarifaria\"\n        ) +\n        theme_minimal() +\n        theme(\n          plot.title = element_text(size = 14, face = \"bold\", color = \"darkblue\"),\n          plot.subtitle = element_text(size = 10, color = \"gray40\"),\n          plot.caption = element_text(size = 9, color = \"gray50\"),\n          axis.title = element_text(size = 11),\n          panel.grid.minor = element_blank(),\n          panel.grid.major = element_line(color = \"gray90\", size = 0.5)\n        )\n      \n      print(p_dist)\n      \n      # Estad√≠sticas descriptivas mejoradas\n      tarifas_unicas <- unique(datos_tarifas$tarifa)\n      rango_tarifas <- max(datos_tarifas$tarifa) - min(datos_tarifas$tarifa)\n      q10 <- quantile(datos_tarifas$tarifa, 0.1)\n      q90 <- quantile(datos_tarifas$tarifa, 0.9)\n      asimetria <- round((mean(datos_tarifas$tarifa) - median(datos_tarifas$tarifa)) / sd(datos_tarifas$tarifa), 3)\n      \n      cat(\"\\n**Estad√≠sticas descriptivas detalladas:**\\n\")\n      cat(\"- **N√∫mero total de tarifas diferentes:** \", length(tarifas_unicas), \"\\n\")\n      cat(\"- **Rango de tarifas:** \", min(datos_tarifas$tarifa), \"‚Ä∞ - \", max(datos_tarifas$tarifa), \"‚Ä∞ (amplitud: \", round(rango_tarifas, 2), \"‚Ä∞)\\n\")\n      cat(\"- **Medidas de tendencia central:**\\n\")\n      cat(\"  - Promedio: \", round(mean(datos_tarifas$tarifa), 2), \"‚Ä∞\\n\")\n      cat(\"  - Mediana: \", round(median(datos_tarifas$tarifa), 2), \"‚Ä∞\\n\")\n      cat(\"  - Moda: \", round(as.numeric(names(sort(table(datos_tarifas$tarifa), decreasing = TRUE))[1]), 2), \"‚Ä∞\\n\")\n      cat(\"- **Medidas de dispersi√≥n:**\\n\")\n      cat(\"  - Desviaci√≥n est√°ndar: \", round(sd(datos_tarifas$tarifa), 2), \"‚Ä∞\\n\")\n      cat(\"  - Coeficiente de variaci√≥n: \", round(sd(datos_tarifas$tarifa)/mean(datos_tarifas$tarifa), 3), \"\\n\")\n      cat(\"  - Rango intercuart√≠lico (P25-P75): \", round(quantile(datos_tarifas$tarifa, 0.75) - quantile(datos_tarifas$tarifa, 0.25), 2), \"‚Ä∞\\n\")\n      cat(\"- **Percentiles clave:**\\n\")\n      cat(\"  - P10: \", round(q10, 2), \"‚Ä∞ | P90: \", round(q90, 2), \"‚Ä∞\\n\")\n      cat(\"- **Forma de la distribuci√≥n:**\\n\")\n      cat(\"  - Asimetr√≠a: \", asimetria, if(asimetria > 0.5) \" (sesgada hacia la derecha)\" else if(asimetria < -0.5) \" (sesgada hacia la izquierda)\" else \" (aproximadamente sim√©trica)\", \"\\n\")\n      \n      # An√°lisis de dispersi√≥n con interpretaci√≥n contextual\n      cv <- sd(datos_tarifas$tarifa)/mean(datos_tarifas$tarifa)\n      \n      cat(\"\\n**üìä An√°lisis de concentraci√≥n tarifaria:**\\n\")\n      if (cv < 0.15) {\n        cat(\"- **Tipo de sistema:** UNIFORME - Las tarifas est√°n muy concentradas\\n\")\n        cat(\"- **Ventajas:** Simplicidad administrativa, f√°cil comprensi√≥n ciudadana\\n\")\n        cat(\"- **Consideraciones:** Evaluar si captura diferencias en capacidad contributiva\\n\")\n      } else if (cv < 0.30) {\n        cat(\"- **Tipo de sistema:** MODERADAMENTE UNIFORME - Concentraci√≥n con cierta variabilidad\\n\")\n        cat(\"- **Ventajas:** Balance entre simplicidad y diferenciaci√≥n\\n\")\n        cat(\"- **Consideraciones:** Sistema equilibrado para contextos urbanos/rurales mixtos\\n\")\n      } else if (cv < 0.70) {\n        cat(\"- **Tipo de sistema:** DIVERSIFICADO - Amplio rango de tarifas\\n\")\n        cat(\"- **Ventajas:** Mayor precisi√≥n en la diferenciaci√≥n contributiva\\n\")\n        cat(\"- **Consideraciones:** Requiere mayor capacidad t√©cnica para aplicaci√≥n\\n\")\n      } else {\n        cat(\"- **Tipo de sistema:** ALTAMENTE DIVERSIFICADO - Muy amplio espectro tarifario\\n\")\n        cat(\"- **Ventajas:** M√°xima precisi√≥n en diferenciaci√≥n\\n\")\n        cat(\"- **Consideraciones:** Alta complejidad administrativa, revisar coherencia\\n\")\n      }\n      \n      # An√°lisis de percentiles con interpretaci√≥n\n      q25 <- quantile(datos_tarifas$tarifa, 0.25)\n      q75 <- quantile(datos_tarifas$tarifa, 0.75)\n      riq <- q75 - q25\n      cat(\"- **Rango central (P25-P75):** \", round(q25, 2), \"‚Ä∞ - \", round(q75, 2), \"‚Ä∞ (RIQ: \", round(riq, 2), \"‚Ä∞)\\n\")\n      cat(\"- **Concentraci√≥n central:** \", round((riq / median(datos_tarifas$tarifa)) * 100, 1), \"% de la mediana\\n\")\n      \n      # Detecci√≥n de outliers\n      limite_inferior <- q25 - 1.5 * riq\n      limite_superior <- q75 + 1.5 * riq\n      outliers <- datos_tarifas$tarifa[datos_tarifas$tarifa < limite_inferior | datos_tarifas$tarifa > limite_superior]\n      \n      if (length(outliers) > 0) {\n        cat(\"- **‚ö†Ô∏è Valores at√≠picos detectados:** \", length(outliers), \" tarifas fuera del rango normal\\n\")\n        cat(\"  - Tarifas extremas: \", paste(round(sort(outliers), 2), collapse = \"‚Ä∞, \"), \"‚Ä∞\\n\")\n        cat(\"  - **Recomendaci√≥n:** Revisar coherencia de estas tarifas excepcionales\\n\")\n      } else {\n        cat(\"- **‚úÖ Sin valores at√≠picos:** Todas las tarifas est√°n dentro del rango esperado\\n\")\n      }\n      \n    } else {\n      cat(\"No se encontraron datos de tarifas para este municipio.\\n\")\n    }\n    \n  }, error = function(e) {\n    cat(\"*No fue posible generar la distribuci√≥n de tarifas para este municipio.*\\n\")\n    cat(\"*Motivo: Datos de transcripci√≥n no disponibles o incompletos.*\\n\")\n  })\n}\n```\n\n# An√°lisis de progresividad\n\n## Progresividad por aval√∫o\n\n```{r}\n#| echo: false\n#| results: asis\n#| fig-width: 10\n#| fig-height: 6\n\n# Verificar si existe la imagen ladder de aval√∫o\nimg_avaluo <- paste0(\"img_estatutos/\", params$cod_dane, \"_ladder_avaluo.png\")\n\nif (file.exists(img_avaluo)) {\n  cat(\"El an√°lisis de progresividad por aval√∫o eval√∫a si las tarifas aumentan proporcionalmente con el valor del predio:\\n\\n\")\n  cat(\"![Progresividad por aval√∫o](\", img_avaluo, \"){width=90%}\\n\\n\")\n  cat(\"**Descripci√≥n:** Gr√°fico ladder que muestra la relaci√≥n entre rangos de aval√∫o (en UVT) y las tarifas correspondientes en \", params$nombre, \".\\n\\n\")\n  cat(\"**Interpretaci√≥n:** Una tendencia ascendente consistente indica progresividad, donde predios de mayor valor pagan tarifas proporcionalmente m√°s altas. Escalones horizontales indican tramos con tarifa fija.\\n\\n\")\n} else {\n  # Generar gr√°fico din√°mico desde los datos\n  cat(\"### An√°lisis de progresividad por aval√∫o (generado din√°micamente)\\n\\n\")\n  \n  # Intentar cargar datos de transcripciones para an√°lisis detallado\n  tryCatch({\n    bd_transcripciones <- lee_rds(\"ds_estatutos/BD_Transcripciones.rds\")\n    \n    # Filtrar datos del municipio\n    datos_avaluo <- bd_transcripciones %>%\n      filter(codigo_dane == params$cod_dane) %>%\n      filter(!is.na(avaluo_desde) | !is.na(avaluo_hasta)) %>%\n      filter(!is.na(tarifa))\n    \n    if (nrow(datos_avaluo) > 0) {\n      library(ggplot2)\n      \n      # Preparar datos para gr√°fico\n      datos_plot <- datos_avaluo %>%\n        mutate(\n          avaluo_medio = case_when(\n            !is.na(avaluo_desde) & !is.na(avaluo_hasta) ~ (avaluo_desde + avaluo_hasta) / 2,\n            !is.na(avaluo_desde) ~ avaluo_desde,\n            !is.na(avaluo_hasta) ~ avaluo_hasta,\n            TRUE ~ NA_real_\n          ),\n          avaluo_desde = ifelse(is.na(avaluo_desde), 0, avaluo_desde),\n          avaluo_hasta = ifelse(is.na(avaluo_hasta), avaluo_medio * 2, avaluo_hasta)\n        ) %>%\n        filter(!is.na(avaluo_medio), !is.na(tarifa)) %>%\n        arrange(avaluo_medio)\n      \n      if (nrow(datos_plot) >= 2) {\n        # Crear gr√°fico ladder\n        p_avaluo <- ggplot(datos_plot, aes(x = avaluo_medio, y = tarifa)) +\n          geom_step(direction = \"hv\", color = \"steelblue\", size = 1.2) +\n          geom_point(color = \"darkblue\", size = 2) +\n          scale_x_continuous(\n            trans = \"log10\",\n            labels = scales::comma_format(scale = 1e-6, suffix = \"M\"),\n            name = \"Aval√∫o (UVT, escala logar√≠tmica)\"\n          ) +\n          scale_y_continuous(\n            labels = scales::number_format(suffix = \"‚Ä∞\"),\n            name = \"Tarifa predial (por mil)\"\n          ) +\n          labs(\n            title = paste(\"Progresividad por aval√∫o -\", params$nombre),\n            subtitle = \"Relaci√≥n entre rangos de aval√∫o y tarifas prediales\",\n            caption = \"Fuente: An√°lisis de estatutos tributarios\"\n          ) +\n          theme_minimal() +\n          theme(\n            plot.title = element_text(size = 14, face = \"bold\"),\n            plot.subtitle = element_text(size = 12),\n            axis.title = element_text(size = 11),\n            panel.grid.minor = element_blank()\n          )\n        \n        print(p_avaluo)\n        \n        # An√°lisis de progresividad\n        correlacion <- cor(datos_plot$avaluo_medio, datos_plot$tarifa, method = \"spearman\")\n        n_intervalos <- nrow(datos_plot)\n        incrementos_positivos <- sum(diff(datos_plot$tarifa[order(datos_plot$avaluo_medio)]) > 0)\n        prop_progresiva <- round(incrementos_positivos / (n_intervalos - 1) * 100, 1)\n        \n        cat(\"\\n**An√°lisis estad√≠stico:**\\n\")\n        cat(\"- **N√∫mero de intervalos analizados:** \", n_intervalos, \"\\n\")\n        cat(\"- **Correlaci√≥n aval√∫o-tarifa (Spearman):** \", round(correlacion, 3), \"\\n\")\n        cat(\"- **Proporci√≥n de incrementos progresivos:** \", prop_progresiva, \"%\\n\")\n        \n        if (correlacion > 0.7) {\n          cat(\"- **Interpretaci√≥n:** Sistema altamente progresivo\\n\")\n        } else if (correlacion > 0.3) {\n          cat(\"- **Interpretaci√≥n:** Sistema moderadamente progresivo\\n\")\n        } else if (correlacion > -0.3) {\n          cat(\"- **Interpretaci√≥n:** Sistema con progresividad variable\\n\")\n        } else {\n          cat(\"- **Interpretaci√≥n:** Sistema con tendencia regresiva\\n\")\n        }\n        \n      } else {\n        cat(\"Datos insuficientes para generar an√°lisis de progresividad por aval√∫o.\\n\")\n      }\n      \n    } else {\n      cat(\"No se encontraron datos de aval√∫o para este municipio en los registros detallados.\\n\")\n    }\n    \n  }, error = function(e) {\n    cat(\"*No fue posible generar el an√°lisis de progresividad por aval√∫o para este municipio.*\\n\")\n    cat(\"*Motivo: Datos de transcripci√≥n no disponibles o incompletos.*\\n\")\n  })\n}\n```\n\n## Progresividad por √°rea\n\n```{r}\n#| echo: false\n#| results: asis\n#| fig-width: 10\n#| fig-height: 6\n\n# Verificar si existe la imagen ladder de √°rea\nimg_area <- paste0(\"img_estatutos/\", params$cod_dane, \"_ladder_area.png\")\n\nif (file.exists(img_area)) {\n  cat(\"El an√°lisis por √°rea eval√∫a la progresividad basada en la superficie construida:\\n\\n\")\n  cat(\"![Progresividad por √°rea](\", img_area, \"){width=90%}\\n\\n\")\n  cat(\"**Descripci√≥n:** Gr√°fico ladder que muestra la relaci√≥n entre rangos de √°rea construida (m¬≤) y las tarifas prediales en \", params$nombre, \".\\n\\n\")\n  cat(\"**Interpretaci√≥n:** Permite evaluar si el municipio penaliza o incentiva predios de mayor tama√±o. Una progresividad negativa podr√≠a indicar incentivos a la densificaci√≥n.\\n\\n\")\n} else {\n  # Generar gr√°fico din√°mico desde los datos\n  cat(\"### An√°lisis de progresividad por √°rea (generado din√°micamente)\\n\\n\")\n  \n  tryCatch({\n    bd_transcripciones <- lee_rds(\"ds_estatutos/BD_Transcripciones.rds\")\n    \n    # Filtrar datos del municipio con informaci√≥n de √°rea\n    datos_area <- bd_transcripciones %>%\n      filter(codigo_dane == params$cod_dane) %>%\n      filter(!is.na(area_desde) | !is.na(area_hasta)) %>%\n      filter(!is.na(tarifa))\n    \n    if (nrow(datos_area) > 0) {\n      library(ggplot2)\n      \n      # Preparar datos para gr√°fico\n      datos_plot_area <- datos_area %>%\n        mutate(\n          area_media = case_when(\n            !is.na(area_desde) & !is.na(area_hasta) ~ (area_desde + area_hasta) / 2,\n            !is.na(area_desde) ~ area_desde,\n            !is.na(area_hasta) ~ area_hasta,\n            TRUE ~ NA_real_\n          ),\n          area_desde = ifelse(is.na(area_desde), 0, area_desde),\n          area_hasta = ifelse(is.na(area_hasta), area_media * 2, area_hasta)\n        ) %>%\n        filter(!is.na(area_media), !is.na(tarifa), area_media > 0) %>%\n        arrange(area_media)\n      \n      if (nrow(datos_plot_area) >= 2) {\n        # Crear gr√°fico ladder para √°rea con mejoras visuales\n        p_area <- ggplot(datos_plot_area, aes(x = area_media, y = tarifa)) +\n          geom_step(direction = \"hv\", color = \"darkgreen\", size = 1.2, alpha = 0.8) +\n          geom_point(color = \"darkgreen\", size = 2.5, alpha = 0.9) +\n          geom_smooth(method = \"loess\", se = TRUE, color = \"orange\", alpha = 0.3, size = 0.8) +\n          scale_x_continuous(\n            trans = \"log10\",\n            labels = scales::comma_format(suffix = \" m¬≤\"),\n            name = \"√Årea construida (m¬≤, escala logar√≠tmica)\",\n            breaks = scales::trans_breaks(\"log10\", function(x) 10^x),\n            minor_breaks = scales::trans_breaks(\"log10\", function(x) 10^x, n = 10)\n          ) +\n          scale_y_continuous(\n            labels = scales::number_format(suffix = \"‚Ä∞\"),\n            name = \"Tarifa predial (por mil)\"\n          ) +\n          labs(\n            title = paste(\"Progresividad por √°rea construida -\", params$nombre),\n            subtitle = \"L√≠nea verde: escalones tarifarios | L√≠nea naranja: tendencia suavizada\",\n            caption = \"Fuente: An√°lisis de estatutos tributarios ‚Ä¢ Mayor √°rea ‚Üí ¬øMayor o menor tarifa?\"\n          ) +\n          theme_minimal() +\n          theme(\n            plot.title = element_text(size = 14, face = \"bold\", color = \"darkgreen\"),\n            plot.subtitle = element_text(size = 11, color = \"gray40\"),\n            plot.caption = element_text(size = 9, color = \"gray50\"),\n            axis.title = element_text(size = 11),\n            panel.grid.minor = element_blank(),\n            panel.grid.major = element_line(color = \"gray90\", size = 0.5)\n          )\n        \n        print(p_area)\n        \n        # An√°lisis de progresividad por √°rea mejorado\n        correlacion_area <- cor(datos_plot_area$area_media, datos_plot_area$tarifa, method = \"spearman\")\n        n_intervalos_area <- nrow(datos_plot_area)\n        tarifa_ordenada <- datos_plot_area$tarifa[order(datos_plot_area$area_media)]\n        incrementos_positivos_area <- sum(diff(tarifa_ordenada) > 0)\n        decrementos_area <- sum(diff(tarifa_ordenada) < 0)\n        prop_progresiva_area <- round(incrementos_positivos_area / (n_intervalos_area - 1) * 100, 1)\n        \n        # Calcular elasticidad √°rea-tarifa\n        if (length(datos_plot_area$area_media) > 2) {\n          modelo_area <- lm(log(tarifa) ~ log(area_media), data = datos_plot_area)\n          elasticidad_area <- round(coef(modelo_area)[2], 3)\n        } else {\n          elasticidad_area <- NA\n        }\n        \n        cat(\"\\n**An√°lisis estad√≠stico avanzado:**\\n\")\n        cat(\"- **N√∫mero de intervalos analizados:** \", n_intervalos_area, \"\\n\")\n        cat(\"- **Correlaci√≥n √°rea-tarifa (Spearman):** \", round(correlacion_area, 3), \"\\n\")\n        cat(\"- **Proporci√≥n de incrementos progresivos:** \", prop_progresiva_area, \"%\\n\")\n        cat(\"- **Incrementos vs. decrementos:** \", incrementos_positivos_area, \" vs \", decrementos_area, \"\\n\")\n        if (!is.na(elasticidad_area)) {\n          cat(\"- **Elasticidad √°rea-tarifa:** \", elasticidad_area, \"\\n\")\n        }\n        \n        if (correlacion_area > 0.3) {\n          cat(\"- **Interpretaci√≥n:** Las tarifas tienden a aumentar con el √°rea (penalizaci√≥n a predios grandes)\\n\")\n        } else if (correlacion_area < -0.3) {\n          cat(\"- **Interpretaci√≥n:** Las tarifas tienden a disminuir con el √°rea (incentivo a predios grandes)\\n\")\n        } else {\n          cat(\"- **Interpretaci√≥n:** Las tarifas no presentan una relaci√≥n clara con el √°rea\\n\")\n        }\n        \n        # Comparaci√≥n con aval√∫o (si disponible)\n        datos_avaluo_comp <- bd_transcripciones %>%\n          filter(codigo_dane == params$cod_dane) %>%\n          filter(!is.na(avaluo_desde) | !is.na(avaluo_hasta)) %>%\n          filter(!is.na(tarifa))\n        \n        if (nrow(datos_avaluo_comp) > 1) {\n          datos_avaluo_comp <- datos_avaluo_comp %>%\n            mutate(\n              avaluo_medio = case_when(\n                !is.na(avaluo_desde) & !is.na(avaluo_hasta) ~ (avaluo_desde + avaluo_hasta) / 2,\n                !is.na(avaluo_desde) ~ avaluo_desde,\n                !is.na(avaluo_hasta) ~ avaluo_hasta,\n                TRUE ~ NA_real_\n              )\n            ) %>%\n            filter(!is.na(avaluo_medio))\n          \n          if (nrow(datos_avaluo_comp) > 1) {\n            correlacion_avaluo_comp <- cor(datos_avaluo_comp$avaluo_medio, datos_avaluo_comp$tarifa, method = \"spearman\")\n            cat(\"- **Comparaci√≥n:** Correlaci√≥n aval√∫o-tarifa: \", round(correlacion_avaluo_comp, 3), \n                \" vs √°rea-tarifa: \", round(correlacion_area, 3), \"\\n\")\n            \n            if (abs(correlacion_area) > abs(correlacion_avaluo_comp)) {\n              cat(\"- **Observaci√≥n:** El √°rea parece ser un criterio m√°s determinante que el aval√∫o\\n\")\n            } else {\n              cat(\"- **Observaci√≥n:** El aval√∫o parece ser un criterio m√°s determinante que el √°rea\\n\")\n            }\n          }\n        }\n        \n      } else {\n        cat(\"Datos insuficientes para generar an√°lisis de progresividad por √°rea.\\n\")\n      }\n      \n    } else {\n      cat(\"No se encontraron datos de √°rea para este municipio en los registros detallados.\\n\")\n    }\n    \n  }, error = function(e) {\n    cat(\"*No fue posible generar el an√°lisis de progresividad por √°rea para este municipio.*\\n\")\n    cat(\"*Motivo: Datos de transcripci√≥n no disponibles o incompletos.*\\n\")\n  })\n}\n```\n\n# Contexto departamental\n\n```{r}\n#| echo: false\n#| results: asis\n\ncat(\"## Posici√≥n relativa en Antioquia\\n\\n\")\n\n# Generar estad√≠sticas comparativas\nif (nrow(datos_municipio) > 0) {\n  # Ranking por n√∫mero de reglas\n  ranking_reglas <- bd_estatutos %>%\n    count(codigo_dane, mpio, sort = TRUE) %>%\n    mutate(ranking = row_number()) %>%\n    filter(codigo_dane == params$cod_dane)\n  \n  if (nrow(ranking_reglas) > 0) {\n    total_municipios <- bd_estatutos %>% distinct(codigo_dane) %>% nrow()\n    cat(\"- **Ranking por complejidad normativa:** \", ranking_reglas$ranking, \" de \", total_municipios, \" municipios\\n\")\n    cat(\"- **N√∫mero de reglas:** \", ranking_reglas$n, \"\\n\")\n    \n    # Clasificaci√≥n\n    if (ranking_reglas$ranking <= total_municipios * 0.25) {\n      cat(\"- **Clasificaci√≥n:** Alta complejidad normativa (cuartil superior)\\n\")\n    } else if (ranking_reglas$ranking <= total_municipios * 0.5) {\n      cat(\"- **Clasificaci√≥n:** Complejidad normativa medio-alta\\n\")\n    } else if (ranking_reglas$ranking <= total_municipios * 0.75) {\n      cat(\"- **Clasificaci√≥n:** Complejidad normativa medio-baja\\n\")\n    } else {\n      cat(\"- **Clasificaci√≥n:** Baja complejidad normativa (cuartil inferior)\\n\")\n    }\n  }\n}\n\ncat(\"\\n\")\n\n# Enlaces a visualizaciones generales si existen\nimg_generales <- c(\n  \"tipologia_agregada.png\" = \"Tipolog√≠as agregadas del departamento\",\n  \"tipologia_todos.png\" = \"Complejidad normativa por municipio\",\n  \"map_rules_count.png\" = \"Mapa de complejidad normativa\",\n  \"tarifas_mapa_urbano.png\" = \"Mapa de tarifas urbanas\",\n  \"tarifas_mapa_rural.png\" = \"Mapa de tarifas rurales\"\n)\n\ncat(\"## Visualizaciones del contexto departamental\\n\\n\")\nfor (i in seq_along(img_generales)) {\n  img_path <- paste0(\"img_estatutos/\", names(img_generales)[i])\n  if (file.exists(img_path)) {\n    cat(\"- [\", img_generales[i], \"](\", img_path, \")\\n\")\n  }\n}\n```\n\n# Documentos de referencia\n\n```{r}\n#| echo: false\n#| results: asis\n\ncat(\"## Estatutos y documentos fuente\\n\\n\")\n\nif (nrow(freq_cat) > 0 && \"enlace_pdf\" %in% names(freq_cat)) {\n  enlaces_disponibles <- freq_cat %>% \n    filter(enlace_pdf != \"No disponible\") %>%\n    nrow()\n  \n  if (enlaces_disponibles > 0) {\n    cat(\"Se han identificado \", enlaces_disponibles, \" documentos fuente para este municipio. \")\n    cat(\"Los enlaces de descarga est√°n disponibles en la tabla de estatutos al inicio de este documento.\\n\\n\")\n  } else {\n    cat(\"Los documentos fuente est√°n en proceso de digitalizaci√≥n.\\n\\n\")\n  }\n} else {\n  cat(\"Los documentos fuente est√°n en proceso de digitalizaci√≥n.\\n\\n\")\n}\n\ncat(\"## Metodolog√≠a del an√°lisis\\n\\n\")\ncat(\"Este an√°lisis forma parte del proyecto de sistematizaci√≥n de estatutos tributarios de Antioquia, que incluye:\\n\\n\")\ncat(\"1. **Transcripci√≥n normativa:** Conversi√≥n de estatutos f√≠sicos a formato digital estructurado\\n\")\ncat(\"2. **Categorizaci√≥n:** Identificaci√≥n de criterios tarifarios (aval√∫o, √°rea, destino, estrato)\\n\")\ncat(\"3. **An√°lisis de progresividad:** Evaluaci√≥n de la coherencia y equidad del sistema tarifario\\n\")\ncat(\"4. **Comparaci√≥n intermunicipal:** Benchmarking con otros municipios del departamento\\n\\n\")\ncat(\"Para m√°s informaci√≥n sobre la metodolog√≠a completa, consulte el [an√°lisis departamental](estatuto_index.html).\\n\")\n```\n\n# Resumen visual integrado\n\n```{r}\n#| echo: false\n#| results: asis\n#| fig-width: 12\n#| fig-height: 8\n\n# Solo generar si hay datos de transcripciones\ntryCatch({\n  bd_transcripciones <- lee_rds(\"ds_estatutos/BD_Transcripciones.rds\")\n  datos_resumen <- bd_transcripciones %>%\n    filter(codigo_dane == params$cod_dane)\n  \n  if (nrow(datos_resumen) > 0) {\n    cat(\"## Dashboard de an√°lisis tributario\\n\\n\")\n    cat(\"Este resumen integra los principales hallazgos del an√°lisis tributario de \", params$nombre, \":\\n\\n\")\n    \n    # Crear un layout de m√∫ltiples gr√°ficos si hay suficientes datos\n    tryCatch({\n      library(gridExtra)\n      library(grid)\n      use_grid <- TRUE\n    }, error = function(e) {\n      use_grid <- FALSE\n    })\n    \n    plots_list <- list()\n    \n    # 1. Gr√°fico de tarifas mejorado con box plot y violin plot\n    datos_tarifas_res <- datos_resumen %>% filter(!is.na(tarifa), tarifa > 0)\n    if (nrow(datos_tarifas_res) > 1) {\n      p1 <- ggplot(datos_tarifas_res, aes(x = \"\", y = tarifa)) +\n        geom_violin(fill = \"lightblue\", alpha = 0.5, color = \"blue\") +\n        geom_boxplot(fill = \"lightblue\", alpha = 0.8, width = 0.3, \n                     outlier.color = \"red\", outlier.size = 2) +\n        geom_jitter(width = 0.1, alpha = 0.6, color = \"darkblue\", size = 1.5) +\n        stat_summary(fun = mean, geom = \"point\", shape = 18, size = 4, color = \"orange\") +\n        labs(\n          title = \"Distribuci√≥n de tarifas\", \n          subtitle = paste(\"üîµ Datos | üì¶ Cuartiles | üü† Promedio | üî¥ Outliers\"),\n          y = \"Tarifa (‚Ä∞)\", \n          x = \"\"\n        ) +\n        theme_minimal() +\n        theme(\n          plot.title = element_text(size = 12, face = \"bold\"),\n          plot.subtitle = element_text(size = 9, color = \"gray50\"),\n          axis.text.x = element_blank(),\n          axis.ticks.x = element_blank()\n        )\n      plots_list <- append(plots_list, list(p1))\n    }\n    \n    # 2. Gr√°fico de progresividad por aval√∫o si hay datos\n    datos_avaluo_res <- datos_resumen %>%\n      filter(!is.na(avaluo_desde) | !is.na(avaluo_hasta)) %>%\n      filter(!is.na(tarifa)) %>%\n      mutate(\n        avaluo_medio = case_when(\n          !is.na(avaluo_desde) & !is.na(avaluo_hasta) ~ (avaluo_desde + avaluo_hasta) / 2,\n          !is.na(avaluo_desde) ~ avaluo_desde,\n          !is.na(avaluo_hasta) ~ avaluo_hasta,\n          TRUE ~ NA_real_\n        )\n      ) %>%\n      filter(!is.na(avaluo_medio)) %>%\n      arrange(avaluo_medio)\n    \n    if (nrow(datos_avaluo_res) >= 3) {\n      # Calcular R¬≤ para mostrar calidad del ajuste\n      modelo_temp <- lm(tarifa ~ log10(avaluo_medio), data = datos_avaluo_res)\n      r_squared <- round(summary(modelo_temp)$r.squared, 3)\n      \n      p2 <- ggplot(datos_avaluo_res, aes(x = avaluo_medio, y = tarifa)) +\n        geom_point(aes(size = avaluo_medio), color = \"darkblue\", alpha = 0.7) +\n        geom_smooth(method = \"lm\", se = TRUE, color = \"red\", linetype = \"dashed\", alpha = 0.3) +\n        geom_smooth(method = \"loess\", se = FALSE, color = \"green\", size = 1, alpha = 0.8) +\n        scale_x_continuous(\n          trans = \"log10\", \n          labels = scales::comma_format(scale = 1e-6, suffix = \"M\"),\n          breaks = scales::trans_breaks(\"log10\", function(x) 10^x, n = 4)\n        ) +\n        scale_size_continuous(guide = \"none\", range = c(1, 4)) +\n        labs(\n          title = \"Progresividad por aval√∫o\", \n          subtitle = paste(\"üî¥ Tendencia lineal (R¬≤=\", r_squared, \") | üü¢ Tendencia suavizada\"),\n          x = \"Aval√∫o (UVT)\", \n          y = \"Tarifa (‚Ä∞)\"\n        ) +\n        theme_minimal() +\n        theme(\n          plot.title = element_text(size = 12, face = \"bold\"),\n          plot.subtitle = element_text(size = 9, color = \"gray50\")\n        )\n      plots_list <- append(plots_list, list(p2))\n    }\n    \n    # 3. Gr√°fico de criterios utilizados\n    criterios_summary <- datos_resumen %>%\n      summarise(\n        Aval√∫o = sum(!is.na(avaluo_desde) | !is.na(avaluo_hasta)),\n        √Årea = sum(!is.na(area_desde) | !is.na(area_hasta)),\n        Destino = sum(!is.na(destino) & destino != \"\", na.rm = TRUE),\n        Estrato = sum(!is.na(estrato) & estrato != \"\", na.rm = TRUE),\n        Zona = sum(!is.na(zona) & zona != \"\", na.rm = TRUE)\n      ) %>%\n      tidyr::pivot_longer(everything(), names_to = \"Criterio\", values_to = \"Frecuencia\") %>%\n      filter(Frecuencia > 0)\n    \n    if (nrow(criterios_summary) > 0) {\n      p3 <- ggplot(criterios_summary, aes(x = reorder(Criterio, Frecuencia), y = Frecuencia)) +\n        geom_col(fill = \"darkgreen\", alpha = 0.7) +\n        coord_flip() +\n        labs(title = \"Criterios utilizados\", x = \"Criterio\", y = \"N√∫mero de reglas\") +\n        theme_minimal() +\n        theme(plot.title = element_text(size = 12, face = \"bold\"))\n      plots_list <- append(plots_list, list(p3))\n    }\n    \n    # Mostrar gr√°ficos\n    if (length(plots_list) > 0) {\n      if (use_grid && length(plots_list) > 1) {\n        # Usar grid si est√° disponible\n        if (length(plots_list) == 2) {\n          grid.arrange(grobs = plots_list, ncol = 2)\n        } else if (length(plots_list) >= 3) {\n          grid.arrange(grobs = plots_list, ncol = 2, nrow = 2)\n        }\n      } else {\n        # Mostrar gr√°ficos individualmente\n        for (i in seq_along(plots_list)) {\n          print(plots_list[[i]])\n        }\n      }\n      \n      cat(\"\\n**üéØ Interpretaci√≥n integral del dashboard:**\\n\")\n      cat(\"Este dashboard proporciona una **visi√≥n 360¬∞ del sistema tributario** de \", params$nombre, \", integrando m√∫ltiples dimensiones anal√≠ticas:\\n\\n\")\n      \n      # An√°lisis integrado m√°s sofisticado\n      cat(\"**üìä Resumen ejecutivo:**\\n\")\n      total_reglas <- nrow(datos_resumen)\n      complejidad_score <- 0\n      \n      # Calcular score de complejidad\n      if (nrow(criterios_summary) > 0) {\n        complejidad_score <- complejidad_score + (nrow(criterios_summary) * 20)\n      }\n      if (nrow(datos_tarifas_res) > 0) {\n        n_tarifas_unicas <- length(unique(datos_tarifas_res$tarifa))\n        complejidad_score <- complejidad_score + min(n_tarifas_unicas * 5, 50)\n        cv_tarifas <- sd(datos_tarifas_res$tarifa) / mean(datos_tarifas_res$tarifa)\n        if (cv_tarifas > 0.5) complejidad_score <- complejidad_score + 30\n      }\n      \n      cat(\"- **üìà Complejidad normativa:** \")\n      if (complejidad_score >= 80) {\n        cat(\"ALTA (score: \", complejidad_score, \") - Sistema muy sofisticado\\n\")\n      } else if (complejidad_score >= 50) {\n        cat(\"MODERADA (score: \", complejidad_score, \") - Sistema equilibrado\\n\")\n      } else {\n        cat(\"BAJA (score: \", complejidad_score, \") - Sistema simplificado\\n\")\n      }\n      \n      cat(\"- **üî¢ Total de reglas analizadas:** \", total_reglas, \"\\n\")\n      \n      if (nrow(datos_tarifas_res) > 0) {\n        tarifa_promedio <- round(mean(datos_tarifas_res$tarifa), 2)\n        tarifa_mediana <- round(median(datos_tarifas_res$tarifa), 2)\n        dispersion <- round(sd(datos_tarifas_res$tarifa) / mean(datos_tarifas_res$tarifa), 3)\n        \n        cat(\"- **üí∞ Estructura tarifaria:**\\n\")\n        cat(\"  - Tarifas √∫nicas: \", length(unique(datos_tarifas_res$tarifa)), \"\\n\")\n        cat(\"  - Tarifa t√≠pica: \", tarifa_mediana, \"‚Ä∞ (mediana)\\n\")\n        cat(\"  - Rango: \", min(datos_tarifas_res$tarifa), \"‚Ä∞ - \", max(datos_tarifas_res$tarifa), \"‚Ä∞\\n\")\n        cat(\"  - Uniformidad: \", if(dispersion < 0.3) \"Alta\" else if(dispersion < 0.7) \"Moderada\" else \"Baja\", \" (CV: \", dispersion, \")\\n\")\n      }\n      \n      if (nrow(criterios_summary) > 0) {\n        criterio_principal <- criterios_summary$Criterio[which.max(criterios_summary$Frecuencia)]\n        cat(\"- **üéØ Criterios tarifarios activos:** \", nrow(criterios_summary), \"\\n\")\n        cat(\"  - Criterio principal: \", criterio_principal, \" (\", max(criterios_summary$Frecuencia), \" reglas)\\n\")\n      }\n      \n      # An√°lisis de progresividad si hay datos de aval√∫o\n      if (nrow(datos_avaluo_res) >= 3) {\n        cor_avaluo <- cor(datos_avaluo_res$avaluo_medio, datos_avaluo_res$tarifa, method = \"spearman\")\n        cat(\"- **üìà Progresividad por aval√∫o:** \")\n        if (cor_avaluo > 0.7) {\n          cat(\"ALTA (r=\", round(cor_avaluo, 2), \") - Sistema muy progresivo\\n\")\n        } else if (cor_avaluo > 0.3) {\n          cat(\"MODERADA (r=\", round(cor_avaluo, 2), \") - Progresividad parcial\\n\")\n        } else if (cor_avaluo > -0.3) {\n          cat(\"VARIABLE (r=\", round(cor_avaluo, 2), \") - Sin patr√≥n claro\\n\")\n        } else {\n          cat(\"REGRESIVA (r=\", round(cor_avaluo, 2), \") - Tarifa decrece con aval√∫o\\n\")\n        }\n      }\n      \n      cat(\"\\n**üîç Recomendaciones basadas en el an√°lisis:**\\n\")\n      if (complejidad_score >= 80) {\n        cat(\"- Considerar **simplificaci√≥n** del esquema tarifario\\n\")\n        cat(\"- Implementar **herramientas digitales** para facilitar aplicaci√≥n\\n\")\n      } else if (complejidad_score < 30) {\n        cat(\"- Evaluar si el esquema actual **captura adecuadamente** la capacidad contributiva\\n\")\n        cat(\"- Considerar mayor **diferenciaci√≥n** tarifaria si es viable\\n\")\n      } else {\n        cat(\"- Mantener **equilibrio actual** entre simplicidad y equidad\\n\")\n        cat(\"- Realizar **revisiones peri√≥dicas** del esquema\\n\")\n      }\n      \n      if (nrow(datos_tarifas_res) > 0 && sd(datos_tarifas_res$tarifa) / mean(datos_tarifas_res$tarifa) > 1) {\n        cat(\"- **Alta dispersi√≥n** detectada: revisar coherencia entre tarifas\\n\")\n      }\n    }\n    \n  } else {\n    cat(\"No hay suficientes datos para generar el dashboard visual.\\n\")\n  }\n  \n}, error = function(e) {\n  cat(\"*Dashboard visual no disponible para este municipio.*\\n\")\n})\n```\n\n# Estad√≠sticas avanzadas del municipio\n\n```{r}\n#| echo: false\n#| results: asis\n\nif (nrow(datos_municipio) > 0) {\n  cat(\"## An√°lisis temporal de la normativa\\n\\n\")\n  \n  # An√°lisis temporal si hay datos de a√±o\n  if (\"anio\" %in% names(datos_municipio) && any(!is.na(datos_municipio$anio))) {\n    # Evoluci√≥n temporal\n    evolucion <- datos_municipio %>%\n      filter(!is.na(anio)) %>%\n      count(anio, sort = TRUE)\n    \n    if (nrow(evolucion) > 1) {\n      cat(\"### Evoluci√≥n de la actividad normativa\\n\\n\")\n      anos_activos <- evolucion$anio\n      cat(\"- **A√±os con mayor actividad normativa:** \", paste(head(anos_activos, 3), collapse = \", \"), \"\\n\")\n      cat(\"- **Per√≠odo de mayor estabilidad:** \")\n      \n      # Buscar per√≠odos sin cambios\n      gaps <- diff(anos_activos)\n      if (any(gaps > 1)) {\n        cat(\"Se observan per√≠odos de estabilidad normativa entre algunos a√±os\\n\")\n      } else {\n        cat(\"Actividad normativa continua en el per√≠odo analizado\\n\")\n      }\n      \n      # Tabla de evoluci√≥n\n      cat(\"\\n\")\n      kable(evolucion, \n            col.names = c(\"A√±o\", \"N√∫mero de registros\"),\n            caption = \"Evoluci√≥n temporal de la normativa tributaria\")\n      cat(\"\\n\")\n    }\n  }\n  \n  # An√°lisis de tipos de normativa\n  if (\"tipo\" %in% names(datos_municipio) && any(!is.na(datos_municipio$tipo))) {\n    cat(\"## Tipolog√≠a normativa\\n\\n\")\n    \n    tipos_freq <- datos_municipio %>%\n      filter(!is.na(tipo)) %>%\n      count(tipo, sort = TRUE)\n    \n    if (nrow(tipos_freq) > 0) {\n      cat(\"### Distribuci√≥n por tipo de normativa\\n\\n\")\n      kable(tipos_freq, \n            col.names = c(\"Tipo de normativa\", \"Frecuencia\"),\n            caption = \"Tipos de instrumentos normativos utilizados\")\n      cat(\"\\n\")\n      \n      tipo_principal <- tipos_freq$tipo[1]\n      freq_principal <- tipos_freq$n[1]\n      porcentaje_principal <- round((freq_principal / nrow(datos_municipio)) * 100, 1)\n      \n      cat(\"- **Instrumento normativo predominante:** \", tipo_principal, \n          \" (\", freq_principal, \" registros, \", porcentaje_principal, \"%)\\n\")\n    }\n  }\n  \n  # Comparaci√≥n con promedios departamentales\n  cat(\"## Comparaci√≥n departamental\\n\\n\")\n  \n  # Estad√≠sticas departamentales\n  stats_dpto <- bd_estatutos %>%\n    group_by(codigo_dane) %>%\n    summarise(\n      total_registros = n(),\n      .groups = 'drop'\n    )\n  \n  promedio_dpto <- mean(stats_dpto$total_registros, na.rm = TRUE)\n  mediana_dpto <- median(stats_dpto$total_registros, na.rm = TRUE)\n  \n  registros_municipio <- nrow(datos_municipio)\n  \n  cat(\"- **Registros de este municipio:** \", registros_municipio, \"\\n\")\n  cat(\"- **Promedio departamental:** \", round(promedio_dpto, 1), \"\\n\")\n  cat(\"- **Mediana departamental:** \", round(mediana_dpto, 1), \"\\n\")\n  \n  # Clasificaci√≥n relativa\n  if (registros_municipio > promedio_dpto) {\n    cat(\"- **Clasificaci√≥n:** Por encima del promedio departamental (\", \n        round((registros_municipio - promedio_dpto) / promedio_dpto * 100, 1), \n        \"% m√°s registros)\\n\")\n  } else {\n    cat(\"- **Clasificaci√≥n:** Por debajo del promedio departamental (\", \n        round((promedio_dpto - registros_municipio) / promedio_dpto * 100, 1), \n        \"% menos registros)\\n\")\n  }\n  \n  # Percentil\n  percentil <- round(sum(stats_dpto$total_registros <= registros_municipio) / nrow(stats_dpto) * 100, 1)\n  cat(\"- **Percentil departamental:** \", percentil, \"% (\", \n      round(100 - percentil, 1), \"% de municipios tienen m√°s registros)\\n\")\n\n} else {\n  cat(\"No hay datos suficientes para generar estad√≠sticas avanzadas.\\n\")\n}\n```\n\n# Recomendaciones espec√≠ficas\n\n```{r}\n#| echo: false\n#| results: asis\n\nif (nrow(datos_municipio) > 0) {\n  cat(\"## Recomendaciones de pol√≠tica tributaria\\n\\n\")\n  \n  # Generar recomendaciones basadas en las caracter√≠sticas del municipio\n  registros_municipio <- nrow(datos_municipio)\n  \n  # Obtener estad√≠sticas para comparaci√≥n\n  stats_dpto <- bd_estatutos %>%\n    group_by(codigo_dane) %>%\n    summarise(total_registros = n(), .groups = 'drop')\n  \n  promedio_dpto <- mean(stats_dpto$total_registros, na.rm = TRUE)\n  cuartil_superior <- quantile(stats_dpto$total_registros, 0.75, na.rm = TRUE)\n  cuartil_inferior <- quantile(stats_dpto$total_registros, 0.25, na.rm = TRUE)\n  \n  cat(\"Bas√°ndose en el an√°lisis comparativo, se sugieren las siguientes recomendaciones:\\n\\n\")\n  \n  if (registros_municipio > cuartil_superior) {\n    cat(\"### Simplificaci√≥n normativa (Alta complejidad)\\n\\n\")\n    cat(\"- **Revisi√≥n integral:** Considerar la consolidaci√≥n de reglas similares para reducir complejidad administrativa\\n\")\n    cat(\"- **Digitalizaci√≥n:** Implementar herramientas digitales para facilitar el c√°lculo y aplicaci√≥n de tarifas\\n\")\n    cat(\"- **Capacitaci√≥n:** Fortalecer las competencias t√©cnicas del personal tributario\\n\")\n    cat(\"- **Comunicaci√≥n:** Desarrollar material did√°ctico para facilitar el entendimiento ciudadano\\n\\n\")\n  } else if (registros_municipio < cuartil_inferior) {\n    cat(\"### Optimizaci√≥n del potencial tributario (Baja complejidad)\\n\\n\")\n    cat(\"- **An√°lisis de brechas:** Evaluar si la simplicidad actual captura adecuadamente la capacidad contributiva\\n\")\n    cat(\"- **Benchmarking:** Considerar mejores pr√°cticas de municipios similares\\n\")\n    cat(\"- **Progresividad:** Evaluar la implementaci√≥n de esquemas m√°s progresivos si es t√©cnicamente viable\\n\")\n    cat(\"- **Actualizaci√≥n:** Revisar la vigencia y pertinencia de las tarifas actuales\\n\\n\")\n  } else {\n    cat(\"### Optimizaci√≥n del esquema actual (Complejidad media)\\n\\n\")\n    cat(\"- **Eficiencia:** Evaluar la efectividad del esquema actual en t√©rminos de recaudo y equidad\\n\")\n    cat(\"- **Actualizaci√≥n peri√≥dica:** Establecer cronogramas regulares de revisi√≥n normativa\\n\")\n    cat(\"- **Monitoreo:** Implementar indicadores de seguimiento a la aplicaci√≥n de tarifas\\n\")\n    cat(\"- **Participaci√≥n:** Involucrar a la ciudadan√≠a en procesos de actualizaci√≥n normativa\\n\\n\")\n  }\n  \n  cat(\"### Recomendaciones generales\\n\\n\")\n  cat(\"- **Transparencia:** Publicar de manera clara y accesible todas las tarifas vigentes\\n\")\n  cat(\"- **Tecnolog√≠a:** Aprovechar herramientas digitales para mejorar la gesti√≥n tributaria\\n\")\n  cat(\"- **Equidad:** Evaluar peri√≥dicamente el impacto distributivo del sistema tarifario\\n\")\n  cat(\"- **Coordinaci√≥n:** Mantener coherencia con las pol√≠ticas tributarias departamentales\\n\\n\")\n  \n} else {\n  cat(\"Para generar recomendaciones espec√≠ficas se requieren datos adicionales del municipio.\\n\")\n}\n```"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":"auto","echo":false,"output":true,"warning":false,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"message":false,"engine":"knitr"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":true,"code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","css":["styles.css"],"toc":true,"toc-depth":3,"number-sections":true,"output-file":"analisis_estatutos.html"},"language":{"toc-title-document":"Tabla de contenidos","toc-title-website":"En esta p√°gina","related-formats-title":"Otros formatos","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Fuente","other-links-title":"Otros Enlaces","code-links-title":"Enlaces de c√≥digo","launch-dev-container-title":"Iniciar Dev Container","launch-binder-title":"Iniciar Binder","article-notebook-label":"Cuaderno de Art√≠culo","notebook-preview-download":"Descargar Cuaderno","notebook-preview-download-src":"Descargar c√≥digo fuente","notebook-preview-back":"Volver al Art√≠culo","manuscript-meca-bundle":"Archivo MECA","section-title-abstract":"Resumen","section-title-appendices":"Ap√©ndices","section-title-footnotes":"Notas","section-title-references":"Referencias","section-title-reuse":"Reutilizaci√≥n","section-title-copyright":"Derechos de autor","section-title-citation":"C√≥mo citar","appendix-attribution-cite-as":"Por favor, cita este trabajo como:","appendix-attribution-bibtex":"BibTeX","appendix-view-license":"Ver Licencia","title-block-author-single":"Autor/a","title-block-author-plural":"Autores/as","title-block-affiliation-single":"Afiliaci√≥n","title-block-affiliation-plural":"Afiliaciones","title-block-published":"Fecha de publicaci√≥n","title-block-modified":"Fecha de √∫ltima modificaci√≥n","title-block-keywords":"Palabras clave","callout-tip-title":"Tip","callout-note-title":"Nota","callout-warning-title":"Advertencia","callout-important-title":"Importante","callout-caution-title":"Precauci√≥n","code-summary":"C√≥digo","code-tools-menu-caption":"C√≥digo","code-tools-show-all-code":"Mostrar todo el c√≥digo","code-tools-hide-all-code":"Ocultar todo el c√≥digo","code-tools-view-source":"Ver el c√≥digo fuente","code-tools-source-code":"Ejecutar el c√≥digo","tools-share":"Compartir","tools-download":"Descargar","code-line":"L√≠nea","code-lines":"L√≠neas","copy-button-tooltip":"Copiar al portapapeles","copy-button-tooltip-success":"Copiado","repo-action-links-edit":"Editar esta p√°gina","repo-action-links-source":"Ver el c√≥digo","repo-action-links-issue":"Informar sobre problema","back-to-top":"Volver arriba","search-no-results-text":"No se han encontrado resultados","search-matching-documents-text":"documentos encontrados","search-copy-link-title":"Copiar el enlace en la b√∫squeda","search-hide-matches-text":"Ocultar resultados adicionales","search-more-match-text":"resultado adicional en este documento","search-more-matches-text":"resultados adicionales en este documento","search-clear-button-title":"Borrar","search-text-placeholder":"","search-detached-cancel-button-title":"Cancelar","search-submit-button-title":"Enviar","search-label":"Buscar","toggle-section":"Alternar secci√≥n","toggle-sidebar":"Alternar barra lateral","toggle-dark-mode":"Alternar modo oscuro","toggle-reader-mode":"Alternar modo lector","toggle-navigation":"Navegaci√≥n de palanca","crossref-fig-title":"Figura","crossref-tbl-title":"Tabla","crossref-lst-title":"Listado","crossref-thm-title":"Teorema","crossref-lem-title":"Lema","crossref-cor-title":"Corolario","crossref-prp-title":"Proposici√≥n","crossref-cnj-title":"Conjetura","crossref-def-title":"Definici√≥n","crossref-exm-title":"Ejemplo","crossref-exr-title":"Ejercicio","crossref-ch-prefix":"Cap√≠tulo","crossref-apx-prefix":"Ap√©ndice","crossref-sec-prefix":"Secci√≥n","crossref-eq-prefix":"Ecuaci√≥n","crossref-lof-title":"Listado de Figuras","crossref-lot-title":"Listado de Tablas","crossref-lol-title":"Listado de Listados","environment-proof-title":"Demostraci√≥n","environment-remark-title":"Observaci√≥n","environment-solution-title":"Soluci√≥n","listing-page-order-by":"Ordenar por","listing-page-order-by-default":"Por defecto","listing-page-order-by-date-asc":"M√°s antiguo","listing-page-order-by-date-desc":"M√°s reciente","listing-page-order-by-number-desc":"De mayor a menor","listing-page-order-by-number-asc":"De menor a mayor","listing-page-field-date":"Fecha","listing-page-field-title":"T√≠tulo","listing-page-field-description":"Descripci√≥n","listing-page-field-author":"Autor/a","listing-page-field-filename":"Nombre del archivo","listing-page-field-filemodified":"√öltima modificaci√≥n","listing-page-field-subtitle":"Subt√≠tulo","listing-page-field-readingtime":"Tiempo de lectura","listing-page-field-wordcount":"Conteo de Palabras","listing-page-field-categories":"Categor√≠as","listing-page-minutes-compact":"{0} minutos","listing-page-category-all":"Todas","listing-page-no-matches":"No hay resultados","listing-page-words":"{0} palabras","listing-page-filter":"Filtro","draft":"Borrador"},"metadata":{"lang":"es","fig-responsive":true,"quarto-version":"1.8.24","theme":["cosmo"],"toc-location":"right","title":"An√°lisis estatuto de Urrao","params":{"cod_dane":"05847","nombre":"Urrao"},"smooth-scroll":true},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html","revealjs"]}